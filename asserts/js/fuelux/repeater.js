(function(d){"function"===typeof define&&define.amd?define(["jquery","fuelux/combobox","fuelux/infinite-scroll","fuelux/search","fuelux/selectlist"],d):d(jQuery)})(function(d){var n=d.fn.repeater,m=function(a,b){var c=this,e,g;this.$element=d(a);this.$canvas=this.$element.find(".repeater-canvas");this.$count=this.$element.find(".repeater-count");this.$end=this.$element.find(".repeater-end");this.$filters=this.$element.find(".repeater-filters");this.$loader=this.$element.find(".repeater-loader");this.$pageSize=
this.$element.find(".repeater-itemization .selectlist");this.$nextBtn=this.$element.find(".repeater-next");this.$pages=this.$element.find(".repeater-pages");this.$prevBtn=this.$element.find(".repeater-prev");this.$primaryPaging=this.$element.find(".repeater-primaryPaging");this.$search=this.$element.find(".repeater-search").find(".search");this.$secondaryPaging=this.$element.find(".repeater-secondaryPaging");this.$start=this.$element.find(".repeater-start");this.$viewport=this.$element.find(".repeater-viewport");
this.$views=this.$element.find(".repeater-views");this.currentPage=0;this.currentView=null;this.infiniteScrollingCallback=function(){};this.infiniteScrollingCont=null;this.infiniteScrollingEnabled=!1;this.infiniteScrollingEnd=null;this.infiniteScrollingOptions={};this.lastPageInput=0;this.options=d.extend({},d.fn.repeater.defaults,b);this.pageIncrement=0;this.resizeTimeout={};this.stamp=(new Date).getTime()+(Math.floor(100*Math.random())+1);this.storedDataSourceOpts=null;this.viewOptions={};this.viewType=
null;this.$filters.selectlist();this.$pageSize.selectlist();this.$primaryPaging.find(".combobox").combobox();this.$search.search();this.$filters.on("changed.fu.selectlist",function(a,b){c.$element.trigger("filtered.fu.repeater",b);c.render({clearInfinite:!0,pageIncrement:null})});this.$nextBtn.on("click.fu.repeater",d.proxy(this.next,this));this.$pageSize.on("changed.fu.selectlist",function(a,b){c.$element.trigger("pageSizeChanged.fu.repeater",b);c.render({pageIncrement:null})});this.$prevBtn.on("click.fu.repeater",
d.proxy(this.previous,this));this.$primaryPaging.find(".combobox").on("changed.fu.combobox",function(a,b){c.$element.trigger("pageChanged.fu.repeater",[b.text,b]);c.pageInputChange(b.text)});this.$search.on("searched.fu.search cleared.fu.search",function(a,b){c.$element.trigger("searchChanged.fu.repeater",b);c.render({clearInfinite:!0,pageIncrement:null})});this.$secondaryPaging.on("blur.fu.repeater",function(a){c.pageInputChange(c.$secondaryPaging.val())});this.$secondaryPaging.on("keyup",function(a){13===
a.keyCode&&c.pageInputChange(c.$secondaryPaging.val())});this.$views.find("input").on("change.fu.repeater",d.proxy(this.viewChanged,this));d(window).on("resize.fu.repeater."+this.stamp,function(a){clearTimeout(c.resizeTimeout);c.resizeTimeout=setTimeout(function(){c.resize();c.$element.trigger("resized.fu.repeater")},75)});this.$loader.loader();this.$loader.loader("pause");-1!==this.options.defaultView?g=this.options.defaultView:(e=this.$views.find("label.active input"),g=0<e.length?e.val():"list");
this.setViewOptions(g);this.initViewTypes(function(){c.resize();c.$element.trigger("resized.fu.repeater");c.render({changeView:g})})};m.prototype={constructor:m,clear:function(a){function b(a){var c=[];a.children().each(function(){var a=d(this),e=a.attr("data-preserve");"deep"===e?(a.detach(),c.push(a)):"shallow"===e&&(b(a),a.detach(),c.push(a))});a.empty();a.append(c)}var c,e;a=a||{};a.preserve?this.infiniteScrollingEnabled&&!a.clearInfinite||b(this.$canvas):this.$canvas.empty();c=void 0!==a.viewChanged?
a.viewChanged:!1;e=d.fn.repeater.viewTypes[this.viewType]||{};!c&&e.cleared&&e.cleared.call(this,{options:a})},clearPreservedDataSourceOptions:function(){this.storedDataSourceOpts=null},destroy:function(){var a;this.$element.find("input").each(function(){d(this).attr("value",d(this).val())});this.$canvas.empty();a=this.$element[0].outerHTML;this.$element.find(".combobox").combobox("destroy");this.$element.find(".selectlist").selectlist("destroy");this.$element.find(".search").search("destroy");this.infiniteScrollingEnabled&&
d(this.infiniteScrollingCont).infinitescroll("destroy");this.$element.remove();d(window).off("resize.fu.repeater."+this.stamp);return a},getDataOptions:function(a){var b={},c={},e;a=a||{};c.filter=0<this.$filters.length?this.$filters.selectlist("selectedItem"):{text:"All",value:"all"};c.view=this.currentView;this.infiniteScrollingEnabled||(c.pageSize=0<this.$pageSize.length?parseInt(this.$pageSize.selectlist("selectedItem").value,10):25);void 0!==a.pageIncrement&&(this.currentPage=null===a.pageIncrement?
0:this.currentPage+a.pageIncrement);c.pageIndex=this.currentPage;e=0<this.$search.length?this.$search.find("input").val():"";""!==e&&(c.search=e);a.dataSourceOptions&&(b=a.dataSourceOptions,a.preserveDataSourceOptions&&(this.storedDataSourceOpts=this.storedDataSourceOpts?d.extend(this.storedDataSourceOpts,b):b));this.storedDataSourceOpts&&(b=d.extend(this.storedDataSourceOpts,b));a=d.fn.repeater.viewTypes[this.viewType]||{};(a=a.dataOptions)?(a=a.call(this,c),c=d.extend(a,b)):c=d.extend(c,b);return c},
infiniteScrolling:function(a,b){var c=this.$element.find(".repeater-itemization"),e=this.$element.find(".repeater-pagination"),d,f;b=b||{};a?(this.infiniteScrollingEnabled=!0,this.infiniteScrollingEnd=b.end,delete b.dataSource,delete b.end,this.infiniteScrollingOptions=b,c.hide(),e.hide()):(d=this.infiniteScrollingCont,f=d.data(),delete f.infinitescroll,d.off("scroll"),d.removeClass("infinitescroll"),this.infiniteScrollingCont=null,this.infiniteScrollingEnabled=!1,this.infiniteScrollingEnd=null,this.infiniteScrollingOptions=
{},c.show(),e.show())},infiniteScrollPaging:function(a,b){var c=!0!==this.infiniteScrollingEnd?this.infiniteScrollingEnd:void 0,e=a.page,d=a.pages;this.currentPage=void 0!==e?e:NaN;this.currentPage+1>=d&&this.infiniteScrollingCont.infinitescroll("end",c)},initInfiniteScrolling:function(){var a=this.$canvas.find('[data-infinite="true"]:first'),b,c,a=1>a.length?this.$canvas:a;a.data("fu.infinitescroll")?a.infinitescroll("enable"):(c=this,b=d.extend({},this.infiniteScrollingOptions),b.dataSource=function(a,
b){c.infiniteScrollingCallback=b;c.render({pageIncrement:1})},a.infinitescroll(b),this.infiniteScrollingCont=a)},initViewTypes:function(a){function b(d){e[d].initialize?e[d].initialize.call(c,{},function(){d++;d<f?b(d):a()}):(d++,d<f?b(d):a())}var c=this,e=[],g,f;for(g in d.fn.repeater.viewTypes)e.push(d.fn.repeater.viewTypes[g]);f=e.length;0<f?b(0):a()},itemization:function(a){this.$count.html(a.count||"");this.$end.html(a.end||"");this.$start.html(a.start||"")},next:function(a){this.$nextBtn.attr("disabled",
"disabled");this.$prevBtn.attr("disabled","disabled");this.pageIncrement=1;this.$element.trigger("nextClicked.fu.repeater");this.render({pageIncrement:this.pageIncrement})},pageInputChange:function(a){var b;a!==this.lastPageInput&&(this.lastPageInput=a,a=parseInt(a,10)-1,b=a-this.currentPage,this.$element.trigger("pageChanged.fu.repeater",a),this.render({pageIncrement:b}))},pagination:function(a){var b=a.page;a=a.pages;var c,d;this.currentPage=void 0!==b?b:NaN;this.$primaryPaging.removeClass("active");
this.$secondaryPaging.removeClass("active");if(a<=this.viewOptions.dropPagingCap){this.$primaryPaging.addClass("active");b=this.$primaryPaging.find(".dropdown-menu");b.empty();for(c=0;c<a;c++)d=c+1,b.append('<li data-value="'+d+'"><a href="#">'+d+"</a></li>");this.$primaryPaging.find("input.form-control").val(this.currentPage+1)}else this.$secondaryPaging.addClass("active"),this.$secondaryPaging.val(this.currentPage+1);this.lastPageInput=this.currentPage+1+"";this.$pages.html(a);this.currentPage+
1<a?this.$nextBtn.removeAttr("disabled"):this.$nextBtn.attr("disabled","disabled");0<=this.currentPage-1?this.$prevBtn.removeAttr("disabled"):this.$prevBtn.attr("disabled","disabled");0!==this.pageIncrement&&(0<this.pageIncrement?this.$nextBtn.is(":disabled")?this.$prevBtn.focus():this.$nextBtn.focus():this.$prevBtn.is(":disabled")?this.$nextBtn.focus():this.$prevBtn.focus())},previous:function(){this.$nextBtn.attr("disabled","disabled");this.$prevBtn.attr("disabled","disabled");this.pageIncrement=
-1;this.$element.trigger("previousClicked.fu.repeater");this.render({pageIncrement:this.pageIncrement})},render:function(a){var b=this,c=!1,e=d.fn.repeater.viewTypes[this.viewType]||{},g,f;a=a||{};a.changeView&&this.currentView!==a.changeView&&(f=this.currentView,this.currentView=a.changeView,this.viewType=this.currentView.split(".")[0],this.setViewOptions(this.currentView),this.$element.attr("data-currentview",this.currentView),this.$element.attr("data-viewtype",this.viewType),c=!0,a.viewChanged=
c,this.$element.trigger("viewChanged.fu.repeater",this.currentView),this.infiniteScrollingEnabled&&b.infiniteScrolling(!1),e=d.fn.repeater.viewTypes[this.viewType]||{},e.selected&&e.selected.call(this,{prevView:f}));a.preserve=void 0!==a.preserve?a.preserve:!c;this.clear(a);(!this.infiniteScrollingEnabled||this.infiniteScrollingEnabled&&c)&&this.$loader.show().loader("play");g=this.getDataOptions(a);this.viewOptions.dataSource(g,function(d){b.infiniteScrollingEnabled?b.infiniteScrollingCallback({}):
(b.itemization(d),b.pagination(d));b.runRenderer(e,d,function(){b.infiniteScrollingEnabled&&((c||a.clearInfinite)&&b.initInfiniteScrolling(),b.infiniteScrollPaging(d,a));b.$loader.hide().loader("pause");b.$element.trigger("rendered.fu.repeater",{data:d,options:g,renderOptions:a});b.$element.trigger("loaded.fu.repeater",g)})})},resize:function(){var a,b,c=-1===this.viewOptions.staticHeight?this.$element.attr("data-staticheight"):this.viewOptions.staticHeight,e={};this.viewType&&(e=d.fn.repeater.viewTypes[this.viewType]||
{});void 0!==c&&!1!==c&&"false"!==c?(this.$canvas.addClass("scrolling"),a=this.$viewport.css("margin-bottom"),b=this.$viewport.css("margin-top"),a=("true"===c||!0===c?this.$element.height():parseInt(c,10))-this.$element.find(".repeater-header").outerHeight()-this.$element.find(".repeater-footer").outerHeight()-("auto"===a?0:parseInt(a,10))-("auto"===b?0:parseInt(b,10)),this.$viewport.outerHeight(a)):this.$canvas.removeClass("scrolling");e.resize&&e.resize.call(this,{height:this.$element.outerHeight(),
width:this.$element.outerWidth()})},runRenderer:function(a,b,c){function e(a,b){var c;b&&(c=b.action?b.action:"append","none"!==c&&void 0!==b.item&&(a=void 0!==b.container?d(b.container):a,a[c](b.item)))}var g,f,l,h,k;if(a.render)a.render.call(this,{container:this.$canvas,data:b},function(){c()});else{a.before&&(h=a.before.call(this,{container:this.$canvas,data:b}),e(this.$canvas,h));g=this.$canvas.find('[data-container="true"]:last');g=0<g.length?g:this.$canvas;if(a.renderItem){h=a.repeat||"data.items";
h=h.split(".");"data"===h[0]||"this"===h[0]?(k="this"===h[0]?this:b,h.shift()):(h=[],k=[],window.console&&window.console.warn&&window.console.warn('WARNING: Repeater plugin "repeat" value must start with either "data" or "this"'));f=0;for(l=h.length;f<l;f++)if(void 0!==k[h[f]])k=k[h[f]];else{k=[];window.console&&window.console.warn&&window.console.warn("WARNING: Repeater unable to find property to iterate renderItem on.");break}f=0;for(l=k.length;f<l;f++)h=a.renderItem.call(this,{container:g,data:b,
index:f,subset:k}),e(g,h)}a.after&&(h=a.after.call(this,{container:this.$canvas,data:b}),e(this.$canvas,h));c()}},setViewOptions:function(a){var b={},b=(b=a.split(".")[1])&&this.options.views?this.options.views[b]||this.options.views[a]||{}:{};this.viewOptions=d.extend({},this.options,b)},viewChanged:function(a){a=d(a.target).val();this.render({changeView:a,pageIncrement:null})}};d.fn.repeater=function(a){var b=Array.prototype.slice.call(arguments,1),c,e=this.each(function(){var e=d(this),f=e.data("fu.repeater"),
l="object"===typeof a&&a;f||e.data("fu.repeater",f=new m(this,l));"string"===typeof a&&(c=f[a].apply(f,b))});return void 0===c?e:c};d.fn.repeater.defaults={dataSource:function(a,b){},defaultView:-1,dropPagingCap:10,staticHeight:-1,views:null};d.fn.repeater.viewTypes={};d.fn.repeater.Constructor=m;d.fn.repeater.noConflict=function(){d.fn.repeater=n;return this}});