var wordImage={},g=baidu.g,flashObj,flashContainer;wordImage.init=function(b,c){showLocalPath("localPath");createFlashUploader(b,c);addUploadListener();addOkListener()};function hideFlash(){flashObj=null;flashContainer.innerHTML=""}
function addOkListener(){dialog.onok=function(){if(imageUrls.length){var b=editor.getOpt("imageUrlPrefix"),c=domUtils.getElementsByTagName(editor.document,"img");editor.fireEvent("saveScene");for(var a=0,d;d=c[a++];){var f=d.getAttribute("word_img");if(f)for(var h=0,e;e=imageUrls[h++];)if(-1!=f.indexOf(e.original.replace(" ",""))){d.src=b+e.url;d.setAttribute("_src",b+e.url);d.setAttribute("title",e.title);domUtils.removeAttributes(d,["word_img","style","width","height"]);editor.fireEvent("selectionchange");
break}}editor.fireEvent("saveScene");hideFlash()}};dialog.oncancel=function(){hideFlash()}}function addUploadListener(){g("upload").onclick=function(){flashObj.upload();this.style.display="none"}}function showLocalPath(b){var c=editor.selection.getRange().getClosedNode(),a=editor.execCommand("wordimage");if(1==a.length||c&&"IMG"==c.tagName)g(b).value=a[0];else{var c=a[0],a=c.lastIndexOf("/")||0,d=c.lastIndexOf("\\")||0,c=c.substring(0,c.lastIndexOf(a>d?"/":"\\")+1);g(b).value=c}}
function createFlashUploader(b,c){var a=utils.extend({},lang.flashI18n),d;for(d in a)d in{lang:1,uploadingTF:1,imageTF:1,textEncoding:1}||!a[d]||(a[d]=encodeURIComponent(editor.options.langPath+editor.options.lang+"/images/"+a[d]));b=utils.extend(b,a,!1);a={createOptions:{id:"flash",url:b.flashUrl,width:b.width,height:b.height,errorMessage:lang.flashError,wmode:browser.safari?"transparent":"window",ver:"10.0.0",vars:b,container:b.container}};a=extendProperty(c,a);flashObj=new baidu.flash.imageUploader(a);
flashContainer=$G(b.container)}function extendProperty(b,c){for(var a in b)c[a]||(c[a]=b[a]);return c}function getPasteData(b){baidu.g("msg").innerHTML=lang.copySuccess+"</br>";setTimeout(function(){baidu.g("msg").innerHTML=""},5E3);return baidu.g(b).value}
function createCopyButton(b,c){baidu.swf.create({id:"copyFlash",url:"fClipboard_ueditor.swf",width:"58",height:"25",errorMessage:"",bgColor:"#CBCBCB",wmode:"transparent",ver:"10.0.0",vars:{tid:c}},b);var a=baidu.swf.getMovie("copyFlash"),d=setInterval(function(){a&&a.flashInit&&(clearInterval(d),a.setHandCursor(!0),a.setContentFuncName("getPasteData"))},500)}createCopyButton("clipboard","localPath");