!function(p,l){var z,k={},g=function(b,a){var d,e,h;if("string"==typeof b)return f(b);d=[];e=b.length;for(h=0;e>h;h++)d.push(f(b[h]));return a.apply(null,d)},f=function(b){var a=k[b]||p[b];if(!a)throw Error("`"+b+"` is undefined");return a},c=l(p,function(b,a,d){2===arguments.length&&(d=a,a=null);g(a||[],function(){var a=arguments,h,m={exports:d};"function"==typeof d&&(a.length||(a=[g,m.exports,m]),h=d.apply(null,a),void 0!==h&&(m.exports=h));k[b]=m.exports})},g);(function(b){var a,d,e,h,m,c;c=function(a){return a&&
a.charAt(0).toUpperCase()+a.substr(1)};for(a in k)if(d=b,k.hasOwnProperty(a)){e=a.split("/");for(m=c(e.pop());h=c(e.shift());)d[h]=d[h]||{},d=d[h];d[m]=k[a]}})(c);"object"==typeof module&&"object"==typeof module.exports?module.exports=c:"function"==typeof define&&define.amd?define([],c):(z=p.WebUploader,p.WebUploader=c,p.WebUploader.noConflict=function(){p.WebUploader=z})}(this,function(p,l,z){return l("dollar-third",[],function(){return p.jQuery||p.Zepto}),l("dollar",["dollar-third"],function(k){return k}),
l("promise-third",["dollar"],function(k){return{Deferred:k.Deferred,when:k.when,isPromise:function(k){return k&&"function"==typeof k.then}}}),l("promise",["promise-third"],function(k){return k}),l("base",["dollar","promise"],function(k,g){function f(a,b){return function(){return a.apply(b,arguments)}}function c(a){var b;return Object.create?Object.create(a):(b=function(){},b.prototype=a,new b)}var b=function(){},a=Function.call;return{version:"0.1.2",$:k,Deferred:g.Deferred,isPromise:g.isPromise,
when:g.when,browser:function(a){var b={},h=a.match(/WebKit\/([\d.]+)/),m=a.match(/Chrome\/([\d.]+)/)||a.match(/CriOS\/([\d.]+)/),c=a.match(/MSIE\s([\d\.]+)/)||a.match(/(?:trident)(?:.*rv:([\w.]+))?/i),M=a.match(/Firefox\/([\d.]+)/),f=a.match(/Safari\/([\d.]+)/);a=a.match(/OPR\/([\d.]+)/);return h&&(b.webkit=parseFloat(h[1])),m&&(b.chrome=parseFloat(m[1])),c&&(b.ie=parseFloat(c[1])),M&&(b.firefox=parseFloat(M[1])),f&&(b.safari=parseFloat(f[1])),a&&(b.opera=parseFloat(a[1])),b}(navigator.userAgent),
os:function(a){var b={},h=a.match(/(?:Android);?[\s\/]+([\d.]+)?/);a=a.match(/(?:iPad|iPod|iPhone).*OS\s([\d_]+)/);return h&&(b.android=parseFloat(h[1])),a&&(b.ios=parseFloat(a[1].replace(/_/g,"."))),b}(navigator.userAgent),inherits:function(a,b,h){var m;return"function"==typeof b?(m=b,b=null):m=b&&b.hasOwnProperty("constructor")?b.constructor:function(){return a.apply(this,arguments)},k.extend(!0,m,a,h||{}),m.__super__=a.prototype,m.prototype=c(a.prototype),b&&k.extend(!0,m.prototype,b),m},noop:b,
bindFn:f,log:p.console?f(console.log,console):b,nextTick:function(){return function(a){setTimeout(a,1)}}(),slice:function(b){return function(){return a.apply(b,arguments)}}([].slice),guid:function(){var a=0;return function(b){for(var h=(+new Date).toString(32),m=0;5>m;m++)h+=Math.floor(65535*Math.random()).toString(32);return(b||"wu_")+h+(a++).toString(32)}}(),formatSize:function(a,b,h){var m;for(h=h||["B","K","M","G","TB"];(m=h.shift())&&1024<a;)a/=1024;return("B"===m?a:a.toFixed(b||2))+m}}}),l("mediator",
["base"],function(k){function g(b,m,d,c){return a.grep(b,function(a){return!(!a||m&&a.e!==m||d&&a.cb!==d&&a.cb._cb!==d||c&&a.ctx!==c)})}function f(b,m,d){a.each((b||"").split(e),function(a,b){d(b,m)})}function c(a,b){for(var d,c=!1,e=-1,f=a.length;++e<f;)if(d=a[e],!1===d.cb.apply(d.ctx2,b)){c=!0;break}return!c}var b,a=k.$,d=[].slice,e=/\s+/;return b={on:function(a,b,d){var c,e=this;return b?(c=this._events||(this._events=[]),f(a,b,function(a,b){var h={e:a};h.cb=b;h.ctx=d;h.ctx2=d||e;h.id=c.length;
c.push(h)}),this):this},once:function(a,b,d){var c=this;return b?(f(a,b,function(a,b){var h=function(){return c.off(a,h),b.apply(d||c,arguments)};h._cb=b;c.on(a,h,d)}),c):c},off:function(b,d,c){var e=this._events;return e?b||d||c?(f(b,d,function(b,h){a.each(g(e,b,h,c),function(){delete e[this.id]})}),this):(this._events=[],this):this},trigger:function(a){var b,e,f;return this._events&&a?(b=d.call(arguments,1),e=g(this._events,a),f=g(this._events,"all"),c(e,b)&&c(f,arguments)):this}},a.extend({installTo:function(h){return a.extend(h,
b)}},b)}),l("uploader",["base","mediator"],function(k,g){function f(b){this.options=c.extend(!0,{},f.options,b);this._init(this.options)}var c=k.$;return f.options={},g.installTo(f.prototype),c.each({upload:"start-upload",stop:"stop-upload",getFile:"get-file",getFiles:"get-files",addFile:"add-file",addFiles:"add-file",sort:"sort-files",removeFile:"remove-file",skipFile:"skip-file",retry:"retry",isInProgress:"is-in-progress",makeThumb:"make-thumb",getDimension:"get-dimension",addButton:"add-btn",getRuntimeType:"get-runtime-type",
refresh:"refresh",disable:"disable",enable:"enable",reset:"reset"},function(b,a){f.prototype[b]=function(){return this.request(a,arguments)}}),c.extend(f.prototype,{state:"pending",_init:function(b){var a=this;a.request("init",b,function(){a.state="ready";a.trigger("ready")})},option:function(b,a){var d=this.options;return 1<arguments.length?void(c.isPlainObject(a)&&c.isPlainObject(d[b])?c.extend(d[b],a):d[b]=a):b?d[b]:d},getStats:function(){var b=this.request("get-stats");return{successNum:b.numOfSuccess,
cancelNum:b.numOfCancel,invalidNum:b.numOfInvalid,uploadFailNum:b.numOfUploadFailed,queueNum:b.numOfQueue}},trigger:function(b){var a=[].slice.call(arguments,1),d=this.options,e="on"+b.substring(0,1).toUpperCase()+b.substring(1);return!1===g.trigger.apply(this,arguments)||c.isFunction(d[e])&&!1===d[e].apply(this,a)||c.isFunction(this[e])&&!1===this[e].apply(this,a)||!1===g.trigger.apply(g,[this,b].concat(a))?!1:!0},request:k.noop}),k.create=f.create=function(b){return new f(b)},k.Uploader=f,f}),l("runtime/runtime",
["base","mediator"],function(k,g){function f(a){this.options=c.extend({container:document.body},a);this.uid=k.guid("rt_")}var c=k.$,b={},a=function(a){for(var b in a)if(a.hasOwnProperty(b))return b;return null};return c.extend(f.prototype,{getContainer:function(){var a,b,h=this.options;return this._container?this._container:(a=c(h.container||document.body),b=c(document.createElement("div")),b.attr("id","rt_"+this.uid),b.css({position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),
a.append(b),a.addClass("webuploader-container"),this._container=b,b)},init:k.noop,exec:k.noop,destroy:function(){this._container&&this._container.parentNode.removeChild(this.__container);this.off()}}),f.orders="html5,flash",f.addRuntime=function(a,c){b[a]=c},f.hasRuntime=function(d){return!(d?!b[d]:!a(b))},f.create=function(d,e){var h;if(e=e||f.orders,c.each(e.split(/\s*,\s*/g),function(){return b[this]?(h=this,!1):void 0}),h=h||a(b),!h)throw Error("Runtime Error");return new b[h](d)},g.installTo(f.prototype),
f}),l("runtime/client",["base","mediator","runtime/runtime"],function(k,g,f){function c(a,d){var c,h=k.Deferred();this.uid=k.guid("client_");this.runtimeReady=function(a){return h.done(a)};this.connectRuntime=function(a,n){if(c)throw Error("already connected!");return h.done(n),"string"==typeof a&&b.get(a)&&(c=b.get(a)),c=c||b.get(null,d),c?(k.$.extend(c.options,a),c.__promise.then(h.resolve),c.__client++):(c=f.create(a,a.runtimeOrder),c.__promise=h.promise(),c.once("ready",h.resolve),c.init(),b.add(c),
c.__client=1),d&&(c.__standalone=d),c};this.getRuntime=function(){return c};this.disconnectRuntime=function(){c&&(c.__client--,0>=c.__client&&(b.remove(c),delete c.__promise,c.destroy()),c=null)};this.exec=function(){if(c){var b=k.slice(arguments);return a&&b.unshift(a),c.exec.apply(this,b)}};this.getRuid=function(){return c&&c.uid};this.destroy=function(a){return function(){a&&a.apply(this,arguments);this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()}}(this.destroy)}
var b;return b=function(){var a={};return{add:function(b){a[b.uid]=b},get:function(b,c){var h;if(b)return a[b];for(h in a)if(!c||!a[h].__standalone)return a[h];return null},remove:function(b){delete a[b.uid]}}}(),g.installTo(c.prototype),c}),l("lib/blob",["base","runtime/client"],function(k,g){function f(c,b){this.source=b;this.ruid=c;g.call(this,"Blob");this.uid=b.uid||this.uid;this.type=b.type||"";this.size=b.size||0;c&&this.connectRuntime(c)}return k.inherits(g,{constructor:f,slice:function(c,
b){return this.exec("slice",c,b)},getSource:function(){return this.source}}),f}),l("lib/file",["base","lib/blob"],function(k,g){function f(a,d){var e;g.apply(this,arguments);this.name=d.name||"untitled"+c++;e=b.exec(d.name)?RegExp.$1.toLowerCase():"";!e&&this.type&&(e=/\/(jpg|jpeg|png|gif|bmp)$/i.exec(this.type)?RegExp.$1.toLowerCase():"",this.name+="."+e);!this.type&&~"jpg,jpeg,png,gif,bmp".indexOf(e)&&(this.type="image/"+("jpg"===e?"jpeg":e));this.ext=e;this.lastModifiedDate=d.lastModifiedDate||
(new Date).toLocaleString()}var c=1,b=/\.([^.]+)$/;return k.inherits(g,f)}),l("lib/filepicker",["base","runtime/client","lib/file"],function(k,g,f){function c(a){if(a=this.options=b.extend({},c.options,a),a.container=b(a.id),!a.container.length)throw Error("\u6309\u94ae\u6307\u5b9a\u9519\u8bef");a.innerHTML=a.innerHTML||a.label||a.container.html()||"";a.button=b(a.button||document.createElement("div"));a.button.html(a.innerHTML);a.container.html(a.button);g.call(this,"FilePicker",!0)}var b=k.$;return c.options=
{button:null,container:null,label:null,innerHTML:null,multiple:!0,accept:null,name:"file"},k.inherits(g,{constructor:c,init:function(){var a=this,c=a.options,e=c.button;e.addClass("webuploader-pick");a.on("all",function(h){switch(h){case "mouseenter":e.addClass("webuploader-pick-hover");break;case "mouseleave":e.removeClass("webuploader-pick-hover");break;case "change":h=a.exec("getFiles"),a.trigger("select",b.map(h,function(b){return b=new f(a.getRuid(),b),b._refer=c.container,b}),c.container)}});
a.connectRuntime(c,function(){a.refresh();a.exec("init",c);a.trigger("ready")});b(p).on("resize",function(){a.refresh()})},refresh:function(){var a=this.getRuntime().getContainer(),b=this.options.button,c=b.outerWidth?b.outerWidth():b.width(),h=b.outerHeight?b.outerHeight():b.height(),b=b.offset();c&&h&&a.css({bottom:"auto",right:"auto",width:c+"px",height:h+"px"}).offset(b)},enable:function(){this.options.button.removeClass("webuploader-pick-disable");this.refresh()},disable:function(){var a=this.options.button;
this.getRuntime().getContainer().css({top:"-99999px"});a.addClass("webuploader-pick-disable")},destroy:function(){this.runtime&&(this.exec("destroy"),this.disconnectRuntime())}}),c}),l("widgets/widget",["base","uploader"],function(k,g){function f(a){if(!a)return!1;var c=a.length,d=b.type(a);return 1===a.nodeType&&c?!0:"array"===d||"function"!==d&&"string"!==d&&(0===c||"number"==typeof c&&0<c&&c-1 in a)}function c(a){this.owner=a;this.options=a.options}var b=k.$,a=g.prototype._init,d={},e=[];return b.extend(c.prototype,
{init:k.noop,invoke:function(a,c){var e=this.responseMap;return e&&a in e&&e[a]in this&&b.isFunction(this[e[a]])?this[e[a]].apply(this,c):d},request:function(){return this.owner.request.apply(this.owner,arguments)}}),b.extend(g.prototype,{_init:function(){var c=this,d=c._widgets=[];return b.each(e,function(a,b){d.push(new b(c))}),a.apply(c,arguments)},request:function(a,b,c){var e,g,B,r=0,l=this._widgets,v=l.length,y=[],C=[];for(b=f(b)?b:[b];v>r;r++)e=l[r],e=e.invoke(a,b),e!==d&&(k.isPromise(e)?C.push(e):
y.push(e));return c||C.length?(g=k.when.apply(k,C),B=g.pipe?"pipe":"then",g[B](function(){var a=k.Deferred(),b=arguments;return setTimeout(function(){a.resolve.apply(a,b)},1),a.promise()})[B](c||k.noop)):y[0]}}),g.register=c.register=function(a,d){var n,f={init:"init"};return 1===arguments.length?(d=a,d.responseMap=f):d.responseMap=b.extend(f,a),n=k.inherits(c,d),e.push(n),n},c}),l("widgets/filepicker",["base","uploader","lib/filepicker","widgets/widget"],function(k,g,f){var c=k.$;return c.extend(g.options,
{pick:null,accept:null}),g.register({"add-btn":"addButton",refresh:"refresh",disable:"disable",enable:"enable"},{init:function(b){return this.pickers=[],b.pick&&this.addButton(b.pick)},refresh:function(){c.each(this.pickers,function(){this.refresh()})},addButton:function(b){var a,d,e,h=this,m=h.options,n=m.accept;if(b)return e=k.Deferred(),c.isPlainObject(b)||(b={id:b}),a=c.extend({},b,{accept:c.isPlainObject(n)?[n]:n,swf:m.swf,runtimeOrder:m.runtimeOrder}),d=new f(a),d.once("ready",e.resolve),d.on("select",
function(a){h.owner.request("add-file",[a])}),d.init(),this.pickers.push(d),e.promise()},disable:function(){c.each(this.pickers,function(){this.disable()})},enable:function(){c.each(this.pickers,function(){this.enable()})}})}),l("lib/image",["base","runtime/client","lib/blob"],function(k,g,f){function c(a){this.options=b.extend({},c.options,a);g.call(this,"Image");this.on("load",function(){this._info=this.exec("info");this._meta=this.exec("meta")})}var b=k.$;return c.options={quality:90,crop:!1,preserveHeaders:!0,
allowMagnify:!0},k.inherits(g,{constructor:c,info:function(a){return a?(this._info=a,this):this._info},meta:function(a){return a?(this._meta=a,this):this._meta},loadFromBlob:function(a){var b=this,c=a.getRuid();this.connectRuntime(c,function(){b.exec("init",b.options);b.exec("loadFromBlob",a)})},resize:function(){var a=k.slice(arguments);return this.exec.apply(this,["resize"].concat(a))},getAsDataUrl:function(a){return this.exec("getAsDataUrl",a)},getAsBlob:function(a){a=this.exec("getAsBlob",a);
return new f(this.getRuid(),a)}}),c}),l("widgets/image",["base","uploader","lib/image","widgets/widget"],function(k,g,f){var c,b=k.$;return c=function(a){var b=0,c=[],h=function(){for(var h;c.length&&a>b;)h=c.shift(),b+=h[0],h[1]()};return function(a,n,f){c.push([n,f]);a.once("destroy",function(){b-=n;setTimeout(h,1)});setTimeout(h,1)}}(5242880),b.extend(g.options,{thumb:{width:110,height:110,quality:70,allowMagnify:!0,crop:!0,preserveHeaders:!1,type:"image/jpeg"},compress:{width:1600,height:1600,
quality:90,allowMagnify:!1,crop:!1,preserveHeaders:!0}}),g.register({"make-thumb":"makeThumb","before-send-file":"compressImage"},{makeThumb:function(a,d,e,h){var m,n;return a=this.request("get-file",a),a.type.match(/^image/)?(m=b.extend({},this.options.thumb),b.isPlainObject(e)&&(m=b.extend(m,e),e=null),e=e||m.width,h=h||m.height,n=new f(m),n.once("load",function(){a._info=a._info||n.info();a._meta=a._meta||n.meta();n.resize(e,h)}),n.once("complete",function(){d(!1,n.getAsDataUrl(m.type));n.destroy()}),
n.once("error",function(){d(!0);n.destroy()}),void c(n,a.source.size,function(){a._info&&n.info(a._info);a._meta&&n.meta(a._meta);n.loadFromBlob(a.source)})):void d(!0)},compressImage:function(a){var c,e,h=this.options.compress||this.options.resize,m=h&&h.compressSize||307200;return a=this.request("get-file",a),!h||!~"image/jpeg,image/jpg".indexOf(a.type)||a.size<m||a._compressed?void 0:(h=b.extend({},h),e=k.Deferred(),c=new f(h),e.always(function(){c.destroy();c=null}),c.once("error",e.reject),c.once("load",
function(){a._info=a._info||c.info();a._meta=a._meta||c.meta();c.resize(h.width,h.height)}),c.once("complete",function(){var b,m;try{b=c.getAsBlob(h.type),m=a.size,b.size<m&&(a.source=b,a.size=b.size,a.trigger("resize",b.size,m)),a._compressed=!0,e.resolve()}catch(f){e.resolve()}}),a._info&&c.info(a._info),a._meta&&c.meta(a._meta),c.loadFromBlob(a.source),e.promise())}})}),l("file",["base","mediator"],function(k,g){function f(e){this.name=e.name||"Untitled";this.size=e.size||0;this.type=e.type||"application";
this.lastModifiedDate=e.lastModifiedDate||1*new Date;this.id=c+b++;this.ext=a.exec(this.name)?RegExp.$1:"";this.statusText="";d[this.id]=f.Status.INITED;this.source=e;this.loaded=0;this.on("error",function(a){this.setStatus(f.Status.ERROR,a)})}var c="WU_FILE_",b=0,a=/\.([^.]+)$/,d={};return k.$.extend(f.prototype,{setStatus:function(a,b){var c=d[this.id];"undefined"!=typeof b&&(this.statusText=b);a!==c&&(d[this.id]=a,this.trigger("statuschange",a,c))},getStatus:function(){return d[this.id]},getSource:function(){return this.source},
destory:function(){delete d[this.id]}}),g.installTo(f.prototype),f.Status={INITED:"inited",QUEUED:"queued",PROGRESS:"progress",ERROR:"error",COMPLETE:"complete",CANCELLED:"cancelled",INTERRUPT:"interrupt",INVALID:"invalid"},f}),l("queue",["base","mediator","file"],function(k,g,f){function c(){this.stats={numOfQueue:0,numOfSuccess:0,numOfCancel:0,numOfProgress:0,numOfUploadFailed:0,numOfInvalid:0};this._queue=[];this._map={}}var b=k.$,a=f.Status;return b.extend(c.prototype,{append:function(a){return this._queue.push(a),
this._fileAdded(a),this},prepend:function(a){return this._queue.unshift(a),this._fileAdded(a),this},getFile:function(a){return"string"!=typeof a?a:this._map[a]},fetch:function(b){var c,h,m=this._queue.length;b=b||a.QUEUED;for(c=0;m>c;c++)if(h=this._queue[c],b===h.getStatus())return h;return null},sort:function(a){"function"==typeof a&&this._queue.sort(a)},getFiles:function(){for(var a,c=[].slice.call(arguments,0),h=[],m=0,n=this._queue.length;n>m;m++)a=this._queue[m],c.length&&!~b.inArray(a.getStatus(),
c)||h.push(a);return h},_fileAdded:function(b){var c=this;this._map[b.id]||(this._map[b.id]=b,b.on("statuschange",function(a,b){c._onFileStatusChange(a,b)}));b.setStatus(a.QUEUED)},_onFileStatusChange:function(b,c){var h=this.stats;switch(c){case a.PROGRESS:h.numOfProgress--;break;case a.QUEUED:h.numOfQueue--;break;case a.ERROR:h.numOfUploadFailed--;break;case a.INVALID:h.numOfInvalid--}switch(b){case a.QUEUED:h.numOfQueue++;break;case a.PROGRESS:h.numOfProgress++;break;case a.ERROR:h.numOfUploadFailed++;
break;case a.COMPLETE:h.numOfSuccess++;break;case a.CANCELLED:h.numOfCancel++;break;case a.INVALID:h.numOfInvalid++}}}),g.installTo(c.prototype),c}),l("widgets/queue","base uploader queue file lib/file runtime/client widgets/widget".split(" "),function(k,g,f,c,b,a){var d=k.$,e=/\.\w+$/,h=c.Status;return g.register({"sort-files":"sortFiles","add-file":"addFiles","get-file":"getFile","fetch-file":"fetchFile","get-stats":"getStats","get-files":"getFiles","remove-file":"removeFile",retry:"retry",reset:"reset",
"accept-file":"acceptFile"},{init:function(b){var c,h,e,g,r,l,v,y=this;if(d.isPlainObject(b.accept)&&(b.accept=[b.accept]),b.accept){r=[];e=0;for(h=b.accept.length;h>e;e++)(g=b.accept[e].extensions)&&r.push(g);r.length&&(l="\\."+r.join(",").replace(/,/g,"$|\\.").replace(/\*/g,".*")+"$");y.accept=new RegExp(l,"i")}return y.queue=new f,y.stats=y.queue.stats,"html5"===this.request("predict-runtime-type")?(c=k.Deferred(),v=new a("Placeholder"),v.connectRuntime({runtimeOrder:"html5"},function(){y._ruid=
v.getRuid();c.resolve()}),c.promise()):void 0},_wrapFile:function(a){if(!(a instanceof c)){if(!(a instanceof b)){if(!this._ruid)throw Error("Can't add external files.");a=new b(this._ruid,a)}a=new c(a)}return a},acceptFile:function(a){return!(!a||6>a.size||this.accept&&e.exec(a.name)&&!this.accept.test(a.name))},_addFile:function(a){return a=this._wrapFile(a),this.owner.trigger("beforeFileQueued",a)?this.acceptFile(a)?(this.queue.append(a),this.owner.trigger("fileQueued",a),a):void this.owner.trigger("error",
"Q_TYPE_DENIED",a):void 0},getFile:function(a){return this.queue.getFile(a)},addFiles:function(a){var b=this;a.length||(a=[a]);a=d.map(a,function(a){return b._addFile(a)});b.owner.trigger("filesQueued",a);b.options.auto&&b.request("start-upload")},getStats:function(){return this.stats},removeFile:function(a){a=a.id?a:this.queue.getFile(a);a.setStatus(h.CANCELLED);this.owner.trigger("fileDequeued",a)},getFiles:function(){return this.queue.getFiles.apply(this.queue,arguments)},fetchFile:function(){return this.queue.fetch.apply(this.queue,
arguments)},retry:function(a,b){var c,d,e;if(a)return a=a.id?a:this.queue.getFile(a),a.setStatus(h.QUEUED),void(b||this.request("start-upload"));c=this.queue.getFiles(h.ERROR);d=0;for(e=c.length;e>d;d++)a=c[d],a.setStatus(h.QUEUED);this.request("start-upload")},sortFiles:function(){return this.queue.sort.apply(this.queue,arguments)},reset:function(){this.queue=new f;this.stats=this.queue.stats}})}),l("widgets/runtime",["uploader","runtime/runtime","widgets/widget"],function(k,g){return k.support=
function(){return g.hasRuntime.apply(g,arguments)},k.register({"predict-runtime-type":"predictRuntmeType"},{init:function(){if(!this.predictRuntmeType())throw Error("Runtime Error");},predictRuntmeType:function(){var f,c,b=this.options.runtimeOrder||g.orders,a=this.type;if(!a)for(b=b.split(/\s*,\s*/g),f=0,c=b.length;c>f;f++)if(g.hasRuntime(b[f])){this.type=a=b[f];break}return a}})}),l("lib/transport",["base","runtime/client","mediator"],function(k,g,f){function c(a){var d=this;a=d.options=b.extend(!0,
{},c.options,a||{});g.call(this,"Transport");this._blob=null;this._formData=a.formData||{};this._headers=a.headers||{};this.on("progress",this._timeout);this.on("load error",function(){d.trigger("progress",1);clearTimeout(d._timer)})}var b=k.$;return c.options={server:"",method:"POST",withCredentials:!1,fileVal:"file",timeout:12E4,formData:{},headers:{},sendAsBinary:!1},b.extend(c.prototype,{appendBlob:function(a,b,c){var h=this,m=h.options;h.getRuid()&&h.disconnectRuntime();h.connectRuntime(b.ruid,
function(){h.exec("init")});h._blob=b;m.fileVal=a||m.fileVal;m.filename=c||m.filename},append:function(a,c){"object"==typeof a?b.extend(this._formData,a):this._formData[a]=c},setRequestHeader:function(a,c){"object"==typeof a?b.extend(this._headers,a):this._headers[a]=c},send:function(a){this.exec("send",a);this._timeout()},abort:function(){return clearTimeout(this._timer),this.exec("abort")},destroy:function(){this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()},getResponse:function(){return this.exec("getResponse")},
getResponseAsJson:function(){return this.exec("getResponseAsJson")},getStatus:function(){return this.exec("getStatus")},_timeout:function(){var a=this,b=a.options.timeout;b&&(clearTimeout(a._timer),a._timer=setTimeout(function(){a.abort();a.trigger("error","timeout")},b))}}),f.installTo(c.prototype),c}),l("widgets/upload",["base","uploader","file","lib/transport","widgets/widget"],function(k,g,f,c){function b(a,b){for(var c,d=[],e=a.source.size,f=b?Math.ceil(e/b):1,k=0,g=0;f>g;)c=Math.min(b,e-k),
d.push({file:a,start:k,end:b?k+c:e,total:e,chunks:f,chunk:g++}),k+=c;return a.blocks=d.concat(),a.remaning=d.length,{file:a,has:function(){return!!d.length},fetch:function(){return d.shift()}}}var a=k.$,d=k.isPromise,e=f.Status;a.extend(g.options,{prepareNextFile:!1,chunked:!1,chunkSize:5242880,chunkRetry:2,threads:3,formData:null});g.register({"start-upload":"start","stop-upload":"stop","skip-file":"skipFile","is-in-progress":"isInProgress"},{init:function(){var b=this.owner;this.runing=!1;this.pool=
[];this.pending=[];this.remaning=0;this.__tick=k.bindFn(this._tick,this);b.on("uploadComplete",function(b){b.blocks&&a.each(b.blocks,function(a,b){b.transport&&(b.transport.abort(),b.transport.destroy());delete b.transport});delete b.blocks;delete b.remaning})},start:function(){var b=this;a.each(b.request("get-files",e.INVALID),function(){b.request("remove-file",this)});b.runing||(b.runing=!0,a.each(b.pool,function(a,c){var d=c.file;d.getStatus()===e.INTERRUPT&&(d.setStatus(e.PROGRESS),b._trigged=
!1,c.transport&&c.transport.send())}),b._trigged=!1,b.owner.trigger("startUpload"),k.nextTick(b.__tick))},stop:function(b){!1!==this.runing&&(this.runing=!1,b&&a.each(this.pool,function(a,b){b.transport&&b.transport.abort();b.file.setStatus(e.INTERRUPT)}),this.owner.trigger("stopUpload"))},isInProgress:function(){return!!this.runing},getStats:function(){return this.request("get-stats")},skipFile:function(b,c){b=this.request("get-file",b);b.setStatus(c||e.COMPLETE);b.skipped=!0;b.blocks&&a.each(b.blocks,
function(a,b){var c=b.transport;c&&(c.abort(),c.destroy(),delete b.transport)});this.owner.trigger("uploadSkip",b)},_tick:function(){var a,b,c=this,e=c.options;return c._promise?c._promise.always(c.__tick):void(c.pool.length<e.threads&&(b=c._nextBlock())?(c._trigged=!1,a=function(a){c._promise=null;a&&a.file&&c._startSend(a);k.nextTick(c.__tick)},c._promise=d(b)?b.always(a):a(b)):c.remaning||c.getStats().numOfQueue||(c.runing=!1,c._trigged||k.nextTick(function(){c.owner.trigger("uploadFinished")}),
c._trigged=!0))},_nextBlock:function(){var a,c,f=this,k=f._act,g=f.options;return k&&k.has()&&k.file.getStatus()===e.PROGRESS?(g.prepareNextFile&&!f.pending.length&&f._prepareNextFile(),k.fetch()):f.runing?(!f.pending.length&&f.getStats().numOfQueue&&f._prepareNextFile(),a=f.pending.shift(),c=function(a){return a?(k=b(a,g.chunked?g.chunkSize:0),f._act=k,k.fetch()):null},d(a)?a[a.pipe?"pipe":"then"](c):c(a)):void 0},_prepareNextFile:function(){var b,c=this,d=c.request("fetch-file"),f=c.pending;d&&
(b=c.request("before-send-file",d,function(){return d.getStatus()===e.QUEUED?(c.owner.trigger("uploadStart",d),d.setStatus(e.PROGRESS),d):c._finishFile(d)}),b.done(function(){var c=a.inArray(b,f);~c&&f.splice(c,1,d)}),b.fail(function(a){d.setStatus(e.ERROR,a);c.owner.trigger("uploadError",d,a);c.owner.trigger("uploadComplete",d)}),f.push(b))},_popBlock:function(b){var c=a.inArray(b,this.pool);this.pool.splice(c,1);b.file.remaning--;this.remaning--},_startSend:function(a){var b=this,c=a.file;b.pool.push(a);
b.remaning++;a.blob=1===a.chunks?c.source:c.source.slice(a.start,a.end);b.request("before-send",a,function(){c.getStatus()===e.PROGRESS?b._doSend(a):(b._popBlock(a),k.nextTick(b.__tick))}).fail(function(){1===c.remaning?b._finishFile(c).always(function(){a.percentage=1;b._popBlock(a);b.owner.trigger("uploadComplete",c);k.nextTick(b.__tick)}):(a.percentage=1,b._popBlock(a),k.nextTick(b.__tick))})},_doSend:function(b){var d,f,g=this,q=g.owner,l=g.options,r=b.file,t=new c(l),v=a.extend({},l.formData),
y=a.extend({},l.headers);b.transport=t;t.on("destroy",function(){delete b.transport;g._popBlock(b);k.nextTick(g.__tick)});t.on("progress",function(c){var d=0,e=0,d=b.percentage=c;1<b.chunks&&(a.each(r.blocks,function(a,b){e+=(b.percentage||0)*(b.end-b.start)}),d=e/r.size);q.trigger("uploadProgress",r,d||0)});d=function(a){var c;return f=t.getResponseAsJson()||{},f._raw=t.getResponse(),c=function(b){a=b},q.trigger("uploadAccept",b,f,c)||(a=a||"server"),a};t.on("error",function(a,c){b.retried=b.retried||
0;1<b.chunks&&~"http,abort".indexOf(a)&&b.retried<l.chunkRetry?(b.retried++,t.send()):(c||"server"!==a||(a=d(a)),r.setStatus(e.ERROR,a),q.trigger("uploadError",r,a),q.trigger("uploadComplete",r))});t.on("load",function(){var a;return(a=d())?void t.trigger("error",a,!0):void(1===r.remaning?g._finishFile(r,f):t.destroy())});v=a.extend(v,{id:r.id,name:r.name,type:r.type,lastModifiedDate:r.lastModifiedDate,size:r.size});1<b.chunks&&a.extend(v,{chunks:b.chunks,chunk:b.chunk});q.trigger("uploadBeforeSend",
b,v,y);t.appendBlob(l.fileVal,b.blob,r.name);t.append(v);t.setRequestHeader(y);t.send()},_finishFile:function(a,b,c){var d=this.owner;return d.request("after-send-file",arguments,function(){a.setStatus(e.COMPLETE);d.trigger("uploadSuccess",a,b,c)}).fail(function(b){a.getStatus()===e.PROGRESS&&a.setStatus(e.ERROR,b);d.trigger("uploadError",a,b)}).always(function(){d.trigger("uploadComplete",a)})}})}),l("runtime/compbase",[],function(){return function(k,g){this.owner=k;this.options=k.options;this.getRuntime=
function(){return g};this.getRuid=function(){return g.uid};this.trigger=function(){return k.trigger.apply(k,arguments)}}}),l("runtime/html5/runtime",["base","runtime/runtime","runtime/compbase"],function(k,g,f){function c(){var c={},e=this,h=this.destory;g.apply(e,arguments);e.type=b;e.exec=function(b,h){var f,g=this.uid,l=k.slice(arguments,2);return a[b]&&(f=c[g]=c[g]||new a[b](this,e),f[h])?f[h].apply(f,l):void 0};e.destory=function(){return h&&h.apply(this,arguments)}}var b="html5",a={};return k.inherits(g,
{constructor:c,init:function(){var a=this;setTimeout(function(){a.trigger("ready")},1)}}),c.register=function(b,c){return a[b]=k.inherits(f,c)},p.Blob&&p.FileReader&&p.DataView&&g.addRuntime(b,c),c}),l("runtime/html5/blob",["runtime/html5/runtime","lib/blob"],function(k,g){return k.register("Blob",{slice:function(f,c){var b=this.owner.source;return b=(b.slice||b.webkitSlice||b.mozSlice).call(b,f,c),new g(this.getRuid(),b)}})}),l("runtime/html5/filepicker",["base","runtime/html5/runtime"],function(k,
g){var f=k.$;return g.register("FilePicker",{init:function(){var c,b,a,d,e=this.getRuntime().getContainer(),h=this,k=h.owner,g=h.options,l=f(document.createElement("label")),q=f(document.createElement("input"));if(q.attr("type","file"),q.attr("name",g.name),q.addClass("webuploader-element-invisible"),l.on("click",function(){q.trigger("click")}),l.css({opacity:0,width:"100%",height:"100%",display:"block",cursor:"pointer",background:"#ffffff"}),g.multiple&&q.attr("multiple","multiple"),g.accept&&0<
g.accept.length){c=[];b=0;for(a=g.accept.length;a>b;b++)c.push(g.accept[b].mimeTypes);q.attr("accept",c.join(","))}e.append(q);e.append(l);d=function(a){k.trigger(a.type)};q.on("change",function(a){var b,c=arguments.callee;h.files=a.target.files;b=this.cloneNode(!0);this.parentNode.replaceChild(b,this);q.off();q=f(b).on("change",c).on("mouseenter mouseleave",d);k.trigger("change")});l.on("mouseenter mouseleave",d)},getFiles:function(){return this.files},destroy:function(){}})}),l("runtime/html5/util",
["base"],function(k){var g=p.createObjectURL&&p||p.URL&&URL.revokeObjectURL&&URL||p.webkitURL,f=k=k.noop;return g&&(k=function(){return g.createObjectURL.apply(g,arguments)},f=function(){return g.revokeObjectURL.apply(g,arguments)}),{createObjectURL:k,revokeObjectURL:f,dataURL2Blob:function(c){var b,a,d,e,h;h=c.split(",");c=~h[0].indexOf("base64")?atob(h[1]):decodeURIComponent(h[1]);a=new ArrayBuffer(c.length);b=new Uint8Array(a);for(d=0;d<c.length;d++)b[d]=c.charCodeAt(d);return e=h[0].split(":")[1].split(";")[0],
this.arrayBufferToBlob(a,e)},dataURL2ArrayBuffer:function(c){var b,a;c=c.split(",");c=~c[0].indexOf("base64")?atob(c[1]):decodeURIComponent(c[1]);b=new Uint8Array(c.length);for(a=0;a<c.length;a++)b[a]=c.charCodeAt(a);return b.buffer},arrayBufferToBlob:function(c,b){var a,d=p.BlobBuilder||p.WebKitBlobBuilder;return d?(a=new d,a.append(c),a.getBlob(b)):new Blob([c],b?{type:b}:{})},canvasToDataUrl:function(c,b,a){return c.toDataURL(b,a/100)},parseMeta:function(c,b){b(!1,{})},updateImageHead:function(c){return c}}}),
l("runtime/html5/imagemeta",["runtime/html5/util"],function(k){var g;return g={parsers:{65505:[]},maxMetaDataSize:262144,parse:function(f,c){var b=this,a=new FileReader;a.onload=function(){c(!1,b._parse(this.result));a=a.onload=a.onerror=null};a.onerror=function(b){c(b.message);a=a.onload=a.onerror=null};f=f.slice(0,b.maxMetaDataSize);a.readAsArrayBuffer(f.getSource())},_parse:function(f,c){if(!(6>f.byteLength)){var b,a,d,e,h=new DataView(f),k=2,n=h.byteLength-4;e=k;var l={};if(65496===h.getUint16(0)){for(;n>
k&&(b=h.getUint16(k),65504<=b&&65519>=b||65534===b)&&(a=h.getUint16(k+2)+2,!(k+a>h.byteLength));){if(d=g.parsers[b],!c&&d)for(e=0;e<d.length;e+=1)d[e].call(g,h,k,a,l);e=k+=a}6<e&&(l.imageHead=f.slice?f.slice(2,e):(new Uint8Array(f)).subarray(2,e))}return l}},updateImageHead:function(f,c){var b,a,d,e=this._parse(f,!0);return d=2,e.imageHead&&(d=2+e.imageHead.byteLength),a=f.slice?f.slice(d):(new Uint8Array(f)).subarray(d),b=new Uint8Array(c.byteLength+2+a.byteLength),b[0]=255,b[1]=216,b.set(new Uint8Array(c),
2),b.set(new Uint8Array(a),c.byteLength+2),b.buffer}},k.parseMeta=function(){return g.parse.apply(g,arguments)},k.updateImageHead=function(){return g.updateImageHead.apply(g,arguments)},g}),l("runtime/html5/imagemeta/exif",["base","runtime/html5/imagemeta"],function(k,g){var f={};return f.ExifMap=function(){return this},f.ExifMap.prototype.map={Orientation:274},f.ExifMap.prototype.get=function(c){return this[c]||this[this.map[c]]},f.exifTagTypes={1:{getValue:function(c,b){return c.getUint8(b)},size:1},
2:{getValue:function(c,b){return String.fromCharCode(c.getUint8(b))},size:1,ascii:!0},3:{getValue:function(c,b,a){return c.getUint16(b,a)},size:2},4:{getValue:function(c,b,a){return c.getUint32(b,a)},size:4},5:{getValue:function(c,b,a){return c.getUint32(b,a)/c.getUint32(b+4,a)},size:8},9:{getValue:function(c,b,a){return c.getInt32(b,a)},size:4},10:{getValue:function(c,b,a){return c.getInt32(b,a)/c.getInt32(b+4,a)},size:8}},f.exifTagTypes[7]=f.exifTagTypes[1],f.getExifValue=function(c,b,a,d,e,h){var g,
n,l;d=f.exifTagTypes[d];if(!d)return void k.log("Invalid Exif data: Invalid tag type.");if(g=d.size*e,n=4<g?b+c.getUint32(a+8,h):a+8,n+g>c.byteLength)return void k.log("Invalid Exif data: Invalid data offset.");if(1===e)return d.getValue(c,n,h);b=[];for(a=0;e>a;a+=1)b[a]=d.getValue(c,n+a*d.size,h);if(d.ascii){c="";for(a=0;a<b.length&&(l=b[a],"\x00"!==l);a+=1)c+=l;return c}return b},f.parseExifTag=function(c,b,a,d,e){var h=c.getUint16(a,d);e.exif[h]=f.getExifValue(c,b,a,c.getUint16(a+2,d),c.getUint32(a+
4,d),d)},f.parseExifTags=function(c,b,a,d,e){var h,f,g;if(a+6>c.byteLength)return void k.log("Invalid Exif data: Invalid directory offset.");if(h=c.getUint16(a,d),f=a+2+12*h,f+4>c.byteLength)return void k.log("Invalid Exif data: Invalid directory size.");for(g=0;h>g;g+=1)this.parseExifTag(c,b,a+2+12*g,d,e);return c.getUint32(f,d)},f.parseExifData=function(c,b,a,d){var e;a=b+10;if(1165519206===c.getUint32(b+4)){if(a+8>c.byteLength)return void k.log("Invalid Exif data: Invalid segment size.");if(0!==
c.getUint16(b+8))return void k.log("Invalid Exif data: Missing byte alignment offset.");switch(c.getUint16(a)){case 18761:b=!0;break;case 19789:b=!1;break;default:return void k.log("Invalid Exif data: Invalid byte alignment marker.")}if(42!==c.getUint16(a+2,b))return void k.log("Invalid Exif data: Missing TIFF marker.");e=c.getUint32(a+4,b);d.exif=new f.ExifMap;f.parseExifTags(c,a,a+e,b,d)}},g.parsers[65505].push(f.parseExifData),f}),l("runtime/html5/image",["base","runtime/html5/runtime","runtime/html5/util"],
function(k,g,f){return g.register("Image",{modified:!1,init:function(){var c=this,b=new Image;b.onload=function(){c._info={type:c.type,width:this.width,height:this.height};c._metas||"image/jpeg"!==c.type?c.owner.trigger("load"):f.parseMeta(c._blob,function(a,b){c._metas=b;c.owner.trigger("load")})};b.onerror=function(){c.owner.trigger("error")};c._img=b},loadFromBlob:function(c){var b=this._img;this._blob=c;this.type=c.type;b.src=f.createObjectURL(c.getSource());this.owner.once("load",function(){f.revokeObjectURL(b.src)})},
resize:function(c,b){var a=this._canvas||(this._canvas=document.createElement("canvas"));this._resize(this._img,a,c,b);this._blob=null;this.modified=!0;this.owner.trigger("complete")},getAsBlob:function(c){var b;b=this._blob;var a=this.options;if(c=c||this.type,this.modified||this.type!==c){if(b=this._canvas,"image/jpeg"===c){if(b=f.canvasToDataUrl(b,"image/jpeg",a.quality),a.preserveHeaders&&this._metas&&this._metas.imageHead)return b=f.dataURL2ArrayBuffer(b),b=f.updateImageHead(b,this._metas.imageHead),
f.arrayBufferToBlob(b,c)}else b=f.canvasToDataUrl(b,c);b=f.dataURL2Blob(b)}return b},getAsDataUrl:function(c){var b=this.options;return c=c||this.type,"image/jpeg"===c?f.canvasToDataUrl(this._canvas,c,b.quality):this._canvas.toDataURL(c)},getOrientation:function(){return this._metas&&this._metas.exif&&this._metas.exif.get("Orientation")||1},info:function(c){return c?(this._info=c,this):this._info},meta:function(c){return c?(this._meta=c,this):this._meta},destroy:function(){var c=this._canvas;this._img.onload=
null;c&&(c.getContext("2d").clearRect(0,0,c.width,c.height),c.width=c.height=0,this._canvas=null);this._img.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D";this._img=this._blob=null},_resize:function(c,b,a,d){var e,h,f=this.options;h=c.width;var k=c.height,g=this.getOrientation();~[5,6,7,8].indexOf(g)&&(a^=d,d^=a,a^=d);e=Math[f.crop?"max":"min"](a/h,d/k);f.allowMagnify||(e=Math.min(1,e));h*=e;e*=k;f.crop?(b.width=a,b.height=d):(b.width=h,b.height=e);a=(b.width-h)/2;d=(b.height-
e)/2;f.preserveHeaders||this._rotate2Orientaion(b,g);this._renderImageToCanvas(b,c,a,d,h,e)},_rotate2Orientaion:function(c,b){var a=c.width,d=c.height,e=c.getContext("2d");switch(b){case 5:case 6:case 7:case 8:c.width=d,c.height=a}switch(b){case 2:e.translate(a,0);e.scale(-1,1);break;case 3:e.translate(a,d);e.rotate(Math.PI);break;case 4:e.translate(0,d);e.scale(1,-1);break;case 5:e.rotate(.5*Math.PI);e.scale(1,-1);break;case 6:e.rotate(.5*Math.PI);e.translate(0,-d);break;case 7:e.rotate(.5*Math.PI);
e.translate(a,-d);e.scale(-1,1);break;case 8:e.rotate(-.5*Math.PI),e.translate(-a,0)}},_renderImageToCanvas:function(){function c(b,a,c){var e,h;e=document.createElement("canvas");var f=e.getContext("2d");a=0;var k=c,g=c;e.width=1;e.height=c;f.drawImage(b,0,0);for(b=f.getImageData(0,0,1,c).data;g>a;)e=b[4*(g-1)+3],0===e?k=g:a=g,g=k+a>>1;return h=g/c,0===h?1:h}return k.os.ios?7<=k.os.ios?function(b,a,d,e,h,f){var k=a.naturalWidth,g=a.naturalHeight,l=c(a,k,g);return b.getContext("2d").drawImage(a,0,
0,k*l,g*l,d,e,h,f)}:function(b,a,d,e,h,f){var k,g,l,p,r=a.naturalWidth,t=a.naturalHeight;b=b.getContext("2d");var v,y;k=a.naturalWidth;k=1048576<k*a.naturalHeight?(v=document.createElement("canvas"),v.width=v.height=1,y=v.getContext("2d"),y.drawImage(a,-k+1,0),0===y.getImageData(0,0,1,1).data[3]):!1;l="image/jpeg"===this.type;y=v=0;k&&(r/=2,t/=2);b.save();k=document.createElement("canvas");k.width=k.height=1024;g=k.getContext("2d");l=l?c(a,r,t):1;h=Math.ceil(1024*h/r);for(f=Math.ceil(1024*f/t/l);t>
v;){for(p=l=0;r>l;)g.clearRect(0,0,1024,1024),g.drawImage(a,-l,-v),b.drawImage(k,0,0,1024,1024,d+p,e+y,h,f),l+=1024,p+=h;v+=1024;y+=f}b.restore()}:function(b,a,c,e,f,k){b.getContext("2d").drawImage(a,c,e,f,k)}}()})}),l("runtime/html5/jpegencoder",[],function(){function k(k){function f(a,b){for(var c=0,d=0,e=[],f=1;16>=f;f++){for(var h=1;h<=a[f];h++)e[b[d]]=[],e[b[d]][0]=c,e[b[d]][1]=f,d++,c++;c*=2}return e}function c(a){var c=a[0];for(a=a[1]-1;0<=a;)c&1<<a&&(J|=1<<F),a--,F--,0>F&&(255==J?(b(255),
b(0)):b(J),F=7,J=0)}function b(a){L.push(O[a])}function a(a){b(a>>8&255);b(255&a)}function d(a,b,d,e,f){var h,k=f[0],g=f[240],l,m,n,r,x,w,p,q,t,u=0;for(t=0;8>t;++t){l=a[u];m=a[u+1];n=a[u+2];r=a[u+3];x=a[u+4];w=a[u+5];p=a[u+6];q=a[u+7];var v=l+q;l-=q;q=m+p;m-=p;p=n+w;n-=w;w=r+x;r-=x;x=v+w;v-=w;w=q+p;q-=p;a[u]=x+w;a[u+4]=x-w;x=.707106781*(q+v);a[u+2]=v+x;a[u+6]=v-x;x=r+n;w=n+m;q=m+l;n=.382683433*(x-q);r=.5411961*x+n;x=1.306562965*q+n;w*=.707106781;n=l+w;l-=w;a[u+5]=l+r;a[u+3]=l-r;a[u+1]=n+x;a[u+7]=
n-x;u+=8}for(t=u=0;8>t;++t)l=a[u],m=a[u+8],n=a[u+16],r=a[u+24],x=a[u+32],w=a[u+40],p=a[u+48],q=a[u+56],v=l+q,l-=q,q=m+p,m-=p,p=n+w,n-=w,w=r+x,r-=x,x=v+w,v-=w,w=q+p,q-=p,a[u]=x+w,a[u+32]=x-w,x=.707106781*(q+v),a[u+16]=v+x,a[u+48]=v-x,x=r+n,w=n+m,q=m+l,n=.382683433*(x-q),r=.5411961*x+n,x=1.306562965*q+n,w*=.707106781,n=l+w,l-=w,a[u+40]=l+r,a[u+24]=l-r,a[u+8]=n+x,a[u+56]=n-x,u++;for(t=0;64>t;++t)u=a[t]*b[t],N[t]=0<u?u+.5|0:u-.5|0;a=N;for(b=0;64>b;++b)E[G[b]]=a[b];a=E[0]-d;d=E[0];0==a?c(e[0]):(h=32767+
a,c(e[z[h]]),c(C[h]));for(e=63;0<e&&0==E[e];e--);if(0==e)return c(k),d;for(a=1;e>=a;){for(h=a;0==E[a]&&e>=a;++a);b=a-h;if(16<=b){h=b>>4;for(t=1;h>=t;++t)c(g);b&=15}h=32767+E[a];c(f[(b<<4)+z[h]]);c(C[h]);a++}return 63!=e&&c(k),d}function e(a){if(0>=a&&(a=1),100<a&&(a=100),q!=a){for(var b=0,b=Math.floor(50>a?5E3/a:200-2*a),c=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,
72,92,95,98,112,100,103,99],d=0;64>d;d++){var e=B((c[d]*b+50)/100);1>e?e=1:255<e&&(e=255);r[G[d]]=e}c=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99];for(d=0;64>d;d++)e=B((c[d]*b+50)/100),1>e?e=1:255<e&&(e=255),t[G[d]]=e;b=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379];for(d=c=0;8>d;d++)for(e=0;8>e;e++)v[c]=1/(r[G[c]]*b[d]*b[e]*
8),y[c]=1/(t[G[c]]*b[d]*b[e]*8),c++;q=a}}var h,l,n,p,q,B=(Math.round,Math.floor),r=Array(64),t=Array(64),v=Array(64),y=Array(64),C=Array(65535),z=Array(65535),N=Array(64),E=Array(64),L=[],J=0,F=7,P=Array(64),Q=Array(64),R=Array(64),O=Array(256),A=Array(2048),G=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],S=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0],T=[0,1,2,3,4,5,6,7,
8,9,10,11],U=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125],V=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,
201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250],W=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0],X=[0,1,2,3,4,5,6,7,8,9,10,11],Y=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119],Z=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,
118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];this.encode=function(f,k){k&&e(k);L=[];J=0;F=7;a(65496);a(65504);a(16);b(74);b(70);b(73);b(70);b(0);b(1);b(1);b(0);a(1);a(1);b(0);b(0);a(65499);a(132);b(0);for(var g=0;64>g;g++)b(r[g]);b(1);for(g=
0;64>g;g++)b(t[g]);var g=f.width,q=f.height;a(65472);a(17);b(8);a(q);a(g);b(3);b(1);b(17);b(0);b(2);b(17);b(1);b(3);b(17);b(1);a(65476);a(418);b(0);for(g=0;16>g;g++)b(S[g+1]);for(g=0;11>=g;g++)b(T[g]);b(16);for(g=0;16>g;g++)b(U[g+1]);for(g=0;161>=g;g++)b(V[g]);b(1);for(g=0;16>g;g++)b(W[g+1]);for(g=0;11>=g;g++)b(X[g]);b(17);for(g=0;16>g;g++)b(Y[g+1]);for(g=0;161>=g;g++)b(Z[g]);a(65498);a(12);b(3);b(1);b(0);b(2);b(17);b(3);b(17);b(0);b(63);b(0);var C=q=g=0;J=0;F=7;this.encode.displayName="_encode_";
for(var z,B,H,D,E,I,G=f.data,x=f.height,w=4*f.width,K=0;x>K;){for(z=0;w>z;){E=w*K+z;for(I=0;64>I;I++)H=I>>3,B=4*(7&I),D=E+H*w+B,K+H>=x&&(D-=w*(K+1+H-x)),z+B>=w&&(D-=z+B-w+4),B=G[D++],H=G[D++],D=G[D++],P[I]=(A[B]+A[H+256>>0]+A[D+512>>0]>>16)-128,Q[I]=(A[B+768>>0]+A[H+1024>>0]+A[D+1280>>0]>>16)-128,R[I]=(A[B+1280>>0]+A[H+1536>>0]+A[D+1792>>0]>>16)-128;g=d(P,v,g,h,n);q=d(Q,y,q,l,p);C=d(R,y,C,l,p);z+=32}K+=8}0<=F&&(g=[],g[1]=F+1,g[0]=(1<<F+1)-1,c(g));a(65497);g="data:image/jpeg;base64,"+btoa(L.join(""));
return L=[],g};k||(k=50);(function(){for(var a=String.fromCharCode,b=0;256>b;b++)O[b]=a(b)})();h=f(S,T);l=f(W,X);n=f(U,V);p=f(Y,Z);(function(){for(var a=1,b=2,c=1;15>=c;c++){for(var d=a;b>d;d++)z[32767+d]=c,C[32767+d]=[],C[32767+d][1]=c,C[32767+d][0]=d;for(d=-(b-1);-a>=d;d++)z[32767+d]=c,C[32767+d]=[],C[32767+d][1]=c,C[32767+d][0]=b-1+d;a<<=1;b<<=1}})();(function(){for(var a=0;256>a;a++)A[a]=19595*a,A[a+256>>0]=38470*a,A[a+512>>0]=7471*a+32768,A[a+768>>0]=-11059*a,A[a+1024>>0]=-21709*a,A[a+1280>>
0]=32768*a+8421375,A[a+1536>>0]=-27439*a,A[a+1792>>0]=-5329*a})();e(k)}return k.encode=function(g,f){return(new k(f)).encode(g)},k}),l("runtime/html5/androidpatch",["runtime/html5/util","runtime/html5/jpegencoder","base"],function(k,g,f){var c,b=k.canvasToDataUrl;k.canvasToDataUrl=function(a,d,e){var h,k,l,p,q;return f.os.android?("image/jpeg"===d&&"undefined"==typeof c&&(p=b.apply(null,arguments),q=p.split(","),p=~q[0].indexOf("base64")?atob(q[1]):decodeURIComponent(q[1]),p=p.substring(0,2),c=255===
p.charCodeAt(0)&&216===p.charCodeAt(1)),"image/jpeg"!==d||c?b.apply(null,arguments):(k=a.width,l=a.height,h=a.getContext("2d"),g.encode(h.getImageData(0,0,k,l),e))):b.apply(null,arguments)}}),l("runtime/html5/transport",["base","runtime/html5/runtime"],function(k,g){var f=k.noop,c=k.$;return g.register("Transport",{init:function(){this._status=0;this._response=null},send:function(){var b,a,d,e=this.owner,f=this.options,g=this._initAjax(),l=e._blob,p=f.server;f.sendAsBinary?(p+=(/\?/.test(p)?"&":"?")+
c.param(e._formData),a=l.getSource()):(b=new FormData,c.each(e._formData,function(a,c){b.append(a,c)}),b.append(f.fileVal,l.getSource(),f.filename||e._formData.name||""));f.withCredentials&&"withCredentials"in g?(g.open(f.method,p,!0),g.withCredentials=!0):g.open(f.method,p);this._setRequestHeader(g,f.headers);a?(g.overrideMimeType("application/octet-stream"),k.os.android?(d=new FileReader,d.onload=function(){g.send(this.result);d=d.onload=null},d.readAsArrayBuffer(a)):g.send(a)):g.send(b)},getResponse:function(){return this._response},
getResponseAsJson:function(){return this._parseJson(this._response)},getStatus:function(){return this._status},abort:function(){var b=this._xhr;b&&(b.upload.onprogress=f,b.onreadystatechange=f,b.abort(),this._xhr=null)},destroy:function(){this.abort()},_initAjax:function(){var b=this,a=new XMLHttpRequest;return!this.options.withCredentials||"withCredentials"in a||"undefined"==typeof XDomainRequest||(a=new XDomainRequest),a.upload.onprogress=function(a){var c=0;return a.lengthComputable&&(c=a.loaded/
a.total),b.trigger("progress",c)},a.onreadystatechange=function(){return 4===a.readyState?(a.upload.onprogress=f,a.onreadystatechange=f,b._xhr=null,b._status=a.status,200<=a.status&&300>a.status?(b._response=a.responseText,b.trigger("load")):500<=a.status&&600>a.status?(b._response=a.responseText,b.trigger("error","server")):b.trigger("error",b._status?"http":"abort")):void 0},b._xhr=a,a},_setRequestHeader:function(b,a){c.each(a,function(a,c){b.setRequestHeader(a,c)})},_parseJson:function(b){var a;
try{a=JSON.parse(b)}catch(c){a={}}return a}})}),l("webuploader","base widgets/filepicker widgets/image widgets/queue widgets/runtime widgets/upload runtime/html5/blob runtime/html5/filepicker runtime/html5/imagemeta/exif runtime/html5/image runtime/html5/androidpatch runtime/html5/transport".split(" "),function(k){return k}),z("webuploader")});