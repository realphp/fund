!function(n,l){var w,e={},h=function(b,a){var f,c,k;if("string"==typeof b)return g(b);f=[];c=b.length;for(k=0;c>k;k++)f.push(g(b[k]));return a.apply(null,f)},g=function(b){var a=e[b]||n[b];if(!a)throw Error("`"+b+"` is undefined");return a},d=l(n,function(b,a,f){2===arguments.length&&(f=a,a=null);h(a||[],function(){var a=arguments,k,m={exports:f};"function"==typeof f&&(a.length||(a=[h,m.exports,m]),k=f.apply(null,a),void 0!==k&&(m.exports=k));e[b]=m.exports})},h);(function(b){var a,f,c,k,m,u;u=function(k){return k&&
k.charAt(0).toUpperCase()+k.substr(1)};for(a in e)if(f=b,e.hasOwnProperty(a)){c=a.split("/");for(m=u(c.pop());k=u(c.shift());)f[k]=f[k]||{},f=f[k];f[m]=e[a]}})(d);"object"==typeof module&&"object"==typeof module.exports?module.exports=d:"function"==typeof define&&define.amd?define([],d):(w=n.WebUploader,n.WebUploader=d,n.WebUploader.noConflict=function(){n.WebUploader=w})}(this,function(n,l,w){return l("dollar-third",[],function(){return n.jQuery||n.Zepto}),l("dollar",["dollar-third"],function(e){return e}),
l("promise-third",["dollar"],function(e){return{Deferred:e.Deferred,when:e.when,isPromise:function(e){return e&&"function"==typeof e.then}}}),l("promise",["promise-third"],function(e){return e}),l("base",["dollar","promise"],function(e,h){function g(a,c){return function(){return a.apply(c,arguments)}}function d(a){var c;return Object.create?Object.create(a):(c=function(){},c.prototype=a,new c)}var b=function(){},a=Function.call;return{version:"0.1.2",$:e,Deferred:h.Deferred,isPromise:h.isPromise,
when:h.when,browser:function(a){var c={},k=a.match(/WebKit\/([\d.]+)/),m=a.match(/Chrome\/([\d.]+)/)||a.match(/CriOS\/([\d.]+)/),b=a.match(/MSIE\s([\d\.]+)/)||a.match(/(?:trident)(?:.*rv:([\w.]+))?/i),d=a.match(/Firefox\/([\d.]+)/),e=a.match(/Safari\/([\d.]+)/);a=a.match(/OPR\/([\d.]+)/);return k&&(c.webkit=parseFloat(k[1])),m&&(c.chrome=parseFloat(m[1])),b&&(c.ie=parseFloat(b[1])),d&&(c.firefox=parseFloat(d[1])),e&&(c.safari=parseFloat(e[1])),a&&(c.opera=parseFloat(a[1])),c}(navigator.userAgent),
os:function(a){var c={},k=a.match(/(?:Android);?[\s\/]+([\d.]+)?/);a=a.match(/(?:iPad|iPod|iPhone).*OS\s([\d_]+)/);return k&&(c.android=parseFloat(k[1])),a&&(c.ios=parseFloat(a[1].replace(/_/g,"."))),c}(navigator.userAgent),inherits:function(a,c,k){var m;return"function"==typeof c?(m=c,c=null):m=c&&c.hasOwnProperty("constructor")?c.constructor:function(){return a.apply(this,arguments)},e.extend(!0,m,a,k||{}),m.__super__=a.prototype,m.prototype=d(a.prototype),c&&e.extend(!0,m.prototype,c),m},noop:b,
bindFn:g,log:n.console?g(console.log,console):b,nextTick:function(){return function(a){setTimeout(a,1)}}(),slice:function(b){return function(){return a.apply(b,arguments)}}([].slice),guid:function(){var a=0;return function(c){for(var k=(+new Date).toString(32),m=0;5>m;m++)k+=Math.floor(65535*Math.random()).toString(32);return(c||"wu_")+k+(a++).toString(32)}}(),formatSize:function(a,c,k){var m;for(k=k||["B","K","M","G","TB"];(m=k.shift())&&1024<a;)a/=1024;return("B"===m?a:a.toFixed(c||2))+m}}}),l("mediator",
["base"],function(e){function h(k,m,c,b){return a.grep(k,function(a){return!(!a||m&&a.e!==m||c&&a.cb!==c&&a.cb._cb!==c||b&&a.ctx!==b)})}function g(k,m,b){a.each((k||"").split(c),function(a,k){b(k,m)})}function d(a,m){for(var c,b=!1,f=-1,d=a.length;++f<d;)if(c=a[f],!1===c.cb.apply(c.ctx2,m)){b=!0;break}return!b}var b,a=e.$,f=[].slice,c=/\s+/;return b={on:function(a,c,b){var f,d=this;return c?(f=this._events||(this._events=[]),g(a,c,function(a,k){var c={e:a};c.cb=k;c.ctx=b;c.ctx2=b||d;c.id=f.length;
f.push(c)}),this):this},once:function(a,c,b){var f=this;return c?(g(a,c,function(a,k){var c=function(){return f.off(a,c),k.apply(b||f,arguments)};c._cb=k;f.on(a,c,b)}),f):f},off:function(k,c,b){var f=this._events;return f?k||c||b?(g(k,c,function(c,k){a.each(h(f,c,k,b),function(){delete f[this.id]})}),this):(this._events=[],this):this},trigger:function(a){var c,b,e;return this._events&&a?(c=f.call(arguments,1),b=h(this._events,a),e=h(this._events,"all"),d(b,c)&&d(e,arguments)):this}},a.extend({installTo:function(c){return a.extend(c,
b)}},b)}),l("uploader",["base","mediator"],function(e,h){function g(b){this.options=d.extend(!0,{},g.options,b);this._init(this.options)}var d=e.$;return g.options={},h.installTo(g.prototype),d.each({upload:"start-upload",stop:"stop-upload",getFile:"get-file",getFiles:"get-files",addFile:"add-file",addFiles:"add-file",sort:"sort-files",removeFile:"remove-file",skipFile:"skip-file",retry:"retry",isInProgress:"is-in-progress",makeThumb:"make-thumb",getDimension:"get-dimension",addButton:"add-btn",getRuntimeType:"get-runtime-type",
refresh:"refresh",disable:"disable",enable:"enable",reset:"reset"},function(b,a){g.prototype[b]=function(){return this.request(a,arguments)}}),d.extend(g.prototype,{state:"pending",_init:function(b){var a=this;a.request("init",b,function(){a.state="ready";a.trigger("ready")})},option:function(b,a){var f=this.options;return 1<arguments.length?void(d.isPlainObject(a)&&d.isPlainObject(f[b])?d.extend(f[b],a):f[b]=a):b?f[b]:f},getStats:function(){var b=this.request("get-stats");return{successNum:b.numOfSuccess,
cancelNum:b.numOfCancel,invalidNum:b.numOfInvalid,uploadFailNum:b.numOfUploadFailed,queueNum:b.numOfQueue}},trigger:function(b){var a=[].slice.call(arguments,1),f=this.options,c="on"+b.substring(0,1).toUpperCase()+b.substring(1);return!1===h.trigger.apply(this,arguments)||d.isFunction(f[c])&&!1===f[c].apply(this,a)||d.isFunction(this[c])&&!1===this[c].apply(this,a)||!1===h.trigger.apply(h,[this,b].concat(a))?!1:!0},request:e.noop}),e.create=g.create=function(b){return new g(b)},e.Uploader=g,g}),l("runtime/runtime",
["base","mediator"],function(e,h){function g(a){this.options=d.extend({container:document.body},a);this.uid=e.guid("rt_")}var d=e.$,b={},a=function(a){for(var c in a)if(a.hasOwnProperty(c))return c;return null};return d.extend(g.prototype,{getContainer:function(){var a,c,k=this.options;return this._container?this._container:(a=d(k.container||document.body),c=d(document.createElement("div")),c.attr("id","rt_"+this.uid),c.css({position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),
a.append(c),a.addClass("webuploader-container"),this._container=c,c)},init:e.noop,exec:e.noop,destroy:function(){this._container&&this._container.parentNode.removeChild(this.__container);this.off()}}),g.orders="html5,flash",g.addRuntime=function(a,c){b[a]=c},g.hasRuntime=function(f){return!(f?!b[f]:!a(b))},g.create=function(f,c){var k;if(c=c||g.orders,d.each(c.split(/\s*,\s*/g),function(){return b[this]?(k=this,!1):void 0}),k=k||a(b),!k)throw Error("Runtime Error");return new b[k](f)},h.installTo(g.prototype),
g}),l("runtime/client",["base","mediator","runtime/runtime"],function(e,h,g){function d(a,f){var c,k=e.Deferred();this.uid=e.guid("client_");this.runtimeReady=function(a){return k.done(a)};this.connectRuntime=function(a,d){if(c)throw Error("already connected!");return k.done(d),"string"==typeof a&&b.get(a)&&(c=b.get(a)),c=c||b.get(null,f),c?(e.$.extend(c.options,a),c.__promise.then(k.resolve),c.__client++):(c=g.create(a,a.runtimeOrder),c.__promise=k.promise(),c.once("ready",k.resolve),c.init(),b.add(c),
c.__client=1),f&&(c.__standalone=f),c};this.getRuntime=function(){return c};this.disconnectRuntime=function(){c&&(c.__client--,0>=c.__client&&(b.remove(c),delete c.__promise,c.destroy()),c=null)};this.exec=function(){if(c){var k=e.slice(arguments);return a&&k.unshift(a),c.exec.apply(this,k)}};this.getRuid=function(){return c&&c.uid};this.destroy=function(a){return function(){a&&a.apply(this,arguments);this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()}}(this.destroy)}
var b;return b=function(){var a={};return{add:function(b){a[b.uid]=b},get:function(b,c){var k;if(b)return a[b];for(k in a)if(!c||!a[k].__standalone)return a[k];return null},remove:function(b){delete a[b.uid]}}}(),h.installTo(d.prototype),d}),l("lib/dnd",["base","mediator","runtime/client"],function(e,h,g){function d(a){a=this.options=b.extend({},d.options,a);a.container=b(a.container);a.container.length&&g.call(this,"DragAndDrop")}var b=e.$;return d.options={accept:null,disableGlobalDnd:!1},e.inherits(g,
{constructor:d,init:function(){var a=this;a.connectRuntime(a.options,function(){a.exec("init");a.trigger("ready")})},destroy:function(){this.disconnectRuntime()}}),h.installTo(d.prototype),d}),l("widgets/widget",["base","uploader"],function(e,h){function g(a){if(!a)return!1;var c=a.length,f=b.type(a);return 1===a.nodeType&&c?!0:"array"===f||"function"!==f&&"string"!==f&&(0===c||"number"==typeof c&&0<c&&c-1 in a)}function d(a){this.owner=a;this.options=a.options}var b=e.$,a=h.prototype._init,f={},
c=[];return b.extend(d.prototype,{init:e.noop,invoke:function(a,c){var d=this.responseMap;return d&&a in d&&d[a]in this&&b.isFunction(this[d[a]])?this[d[a]].apply(this,c):f},request:function(){return this.owner.request.apply(this.owner,arguments)}}),b.extend(h.prototype,{_init:function(){var k=this,f=k._widgets=[];return b.each(c,function(a,c){f.push(new c(k))}),a.apply(k,arguments)},request:function(a,c,b){var d,h,r,p=0,q=this._widgets,l=q.length,n=[],y=[];for(c=g(c)?c:[c];l>p;p++)d=q[p],d=d.invoke(a,
c),d!==f&&(e.isPromise(d)?y.push(d):n.push(d));return b||y.length?(h=e.when.apply(e,y),r=h.pipe?"pipe":"then",h[r](function(){var a=e.Deferred(),c=arguments;return setTimeout(function(){a.resolve.apply(a,c)},1),a.promise()})[r](b||e.noop)):n[0]}}),h.register=d.register=function(a,f){var u,g={init:"init"};return 1===arguments.length?(f=a,f.responseMap=g):f.responseMap=b.extend(g,a),u=e.inherits(d,f),c.push(u),u},d}),l("widgets/filednd",["base","uploader","lib/dnd","widgets/widget"],function(e,h,g){var d=
e.$;return h.options.dnd="",h.register({init:function(b){if(b.dnd&&"html5"===this.request("predict-runtime-type")){var a,f=this,c=e.Deferred();b=d.extend({},{disableGlobalDnd:b.disableGlobalDnd,container:b.dnd,accept:b.accept});return a=new g(b),a.once("ready",c.resolve),a.on("drop",function(a){f.request("add-file",[a])}),a.on("accept",function(a){return f.owner.trigger("dndAccept",a)}),a.init(),c.promise()}}})}),l("lib/filepaste",["base","mediator","runtime/client"],function(e,h,g){function d(a){a=
this.options=b.extend({},a);a.container=b(a.container||document.body);g.call(this,"FilePaste")}var b=e.$;return e.inherits(g,{constructor:d,init:function(){var a=this;a.connectRuntime(a.options,function(){a.exec("init");a.trigger("ready")})},destroy:function(){this.exec("destroy");this.disconnectRuntime();this.off()}}),h.installTo(d.prototype),d}),l("widgets/filepaste",["base","uploader","lib/filepaste","widgets/widget"],function(e,h,g){var d=e.$;return h.register({init:function(b){if(b.paste&&"html5"===
this.request("predict-runtime-type")){var a,f=this,c=e.Deferred();b=d.extend({},{container:b.paste,accept:b.accept});return a=new g(b),a.once("ready",c.resolve),a.on("paste",function(a){f.owner.request("add-file",[a])}),a.init(),c.promise()}}})}),l("lib/blob",["base","runtime/client"],function(e,h){function g(d,b){this.source=b;this.ruid=d;h.call(this,"Blob");this.uid=b.uid||this.uid;this.type=b.type||"";this.size=b.size||0;d&&this.connectRuntime(d)}return e.inherits(h,{constructor:g,slice:function(d,
b){return this.exec("slice",d,b)},getSource:function(){return this.source}}),g}),l("lib/file",["base","lib/blob"],function(e,h){function g(a,f){var c;h.apply(this,arguments);this.name=f.name||"untitled"+d++;c=b.exec(f.name)?RegExp.$1.toLowerCase():"";!c&&this.type&&(c=/\/(jpg|jpeg|png|gif|bmp)$/i.exec(this.type)?RegExp.$1.toLowerCase():"",this.name+="."+c);!this.type&&~"jpg,jpeg,png,gif,bmp".indexOf(c)&&(this.type="image/"+("jpg"===c?"jpeg":c));this.ext=c;this.lastModifiedDate=f.lastModifiedDate||
(new Date).toLocaleString()}var d=1,b=/\.([^.]+)$/;return e.inherits(h,g)}),l("lib/filepicker",["base","runtime/client","lib/file"],function(e,h,g){function d(a){if(a=this.options=b.extend({},d.options,a),a.container=b(a.id),!a.container.length)throw Error("\u6309\u94ae\u6307\u5b9a\u9519\u8bef");a.innerHTML=a.innerHTML||a.label||a.container.html()||"";a.button=b(a.button||document.createElement("div"));a.button.html(a.innerHTML);a.container.html(a.button);h.call(this,"FilePicker",!0)}var b=e.$;return d.options=
{button:null,container:null,label:null,innerHTML:null,multiple:!0,accept:null,name:"file"},e.inherits(h,{constructor:d,init:function(){var a=this,f=a.options,c=f.button;c.addClass("webuploader-pick");a.on("all",function(k){switch(k){case "mouseenter":c.addClass("webuploader-pick-hover");break;case "mouseleave":c.removeClass("webuploader-pick-hover");break;case "change":k=a.exec("getFiles"),a.trigger("select",b.map(k,function(c){return c=new g(a.getRuid(),c),c._refer=f.container,c}),f.container)}});
a.connectRuntime(f,function(){a.refresh();a.exec("init",f);a.trigger("ready")});b(n).on("resize",function(){a.refresh()})},refresh:function(){var a=this.getRuntime().getContainer(),b=this.options.button,c=b.outerWidth?b.outerWidth():b.width(),k=b.outerHeight?b.outerHeight():b.height(),b=b.offset();c&&k&&a.css({bottom:"auto",right:"auto",width:c+"px",height:k+"px"}).offset(b)},enable:function(){this.options.button.removeClass("webuploader-pick-disable");this.refresh()},disable:function(){var a=this.options.button;
this.getRuntime().getContainer().css({top:"-99999px"});a.addClass("webuploader-pick-disable")},destroy:function(){this.runtime&&(this.exec("destroy"),this.disconnectRuntime())}}),d}),l("widgets/filepicker",["base","uploader","lib/filepicker","widgets/widget"],function(e,h,g){var d=e.$;return d.extend(h.options,{pick:null,accept:null}),h.register({"add-btn":"addButton",refresh:"refresh",disable:"disable",enable:"enable"},{init:function(b){return this.pickers=[],b.pick&&this.addButton(b.pick)},refresh:function(){d.each(this.pickers,
function(){this.refresh()})},addButton:function(b){var a,f,c,k=this,m=k.options,u=m.accept;if(b)return c=e.Deferred(),d.isPlainObject(b)||(b={id:b}),a=d.extend({},b,{accept:d.isPlainObject(u)?[u]:u,swf:m.swf,runtimeOrder:m.runtimeOrder}),f=new g(a),f.once("ready",c.resolve),f.on("select",function(a){k.owner.request("add-file",[a])}),f.init(),this.pickers.push(f),c.promise()},disable:function(){d.each(this.pickers,function(){this.disable()})},enable:function(){d.each(this.pickers,function(){this.enable()})}})}),
l("file",["base","mediator"],function(e,h){function g(c){this.name=c.name||"Untitled";this.size=c.size||0;this.type=c.type||"application";this.lastModifiedDate=c.lastModifiedDate||1*new Date;this.id=d+b++;this.ext=a.exec(this.name)?RegExp.$1:"";this.statusText="";f[this.id]=g.Status.INITED;this.source=c;this.loaded=0;this.on("error",function(a){this.setStatus(g.Status.ERROR,a)})}var d="WU_FILE_",b=0,a=/\.([^.]+)$/,f={};return e.$.extend(g.prototype,{setStatus:function(a,b){var m=f[this.id];"undefined"!=
typeof b&&(this.statusText=b);a!==m&&(f[this.id]=a,this.trigger("statuschange",a,m))},getStatus:function(){return f[this.id]},getSource:function(){return this.source},destory:function(){delete f[this.id]}}),h.installTo(g.prototype),g.Status={INITED:"inited",QUEUED:"queued",PROGRESS:"progress",ERROR:"error",COMPLETE:"complete",CANCELLED:"cancelled",INTERRUPT:"interrupt",INVALID:"invalid"},g}),l("queue",["base","mediator","file"],function(e,h,g){function d(){this.stats={numOfQueue:0,numOfSuccess:0,
numOfCancel:0,numOfProgress:0,numOfUploadFailed:0,numOfInvalid:0};this._queue=[];this._map={}}var b=e.$,a=g.Status;return b.extend(d.prototype,{append:function(a){return this._queue.push(a),this._fileAdded(a),this},prepend:function(a){return this._queue.unshift(a),this._fileAdded(a),this},getFile:function(a){return"string"!=typeof a?a:this._map[a]},fetch:function(b){var c,k,m=this._queue.length;b=b||a.QUEUED;for(c=0;m>c;c++)if(k=this._queue[c],b===k.getStatus())return k;return null},sort:function(a){"function"==
typeof a&&this._queue.sort(a)},getFiles:function(){for(var a,c=[].slice.call(arguments,0),k=[],m=0,d=this._queue.length;d>m;m++)a=this._queue[m],c.length&&!~b.inArray(a.getStatus(),c)||k.push(a);return k},_fileAdded:function(b){var c=this;this._map[b.id]||(this._map[b.id]=b,b.on("statuschange",function(a,b){c._onFileStatusChange(a,b)}));b.setStatus(a.QUEUED)},_onFileStatusChange:function(b,c){var k=this.stats;switch(c){case a.PROGRESS:k.numOfProgress--;break;case a.QUEUED:k.numOfQueue--;break;case a.ERROR:k.numOfUploadFailed--;
break;case a.INVALID:k.numOfInvalid--}switch(b){case a.QUEUED:k.numOfQueue++;break;case a.PROGRESS:k.numOfProgress++;break;case a.ERROR:k.numOfUploadFailed++;break;case a.COMPLETE:k.numOfSuccess++;break;case a.CANCELLED:k.numOfCancel++;break;case a.INVALID:k.numOfInvalid++}}}),h.installTo(d.prototype),d}),l("widgets/queue","base uploader queue file lib/file runtime/client widgets/widget".split(" "),function(e,h,g,d,b,a){var f=e.$,c=/\.\w+$/,k=d.Status;return h.register({"sort-files":"sortFiles","add-file":"addFiles",
"get-file":"getFile","fetch-file":"fetchFile","get-stats":"getStats","get-files":"getFiles","remove-file":"removeFile",retry:"retry",reset:"reset","accept-file":"acceptFile"},{init:function(c){var b,k,d,h,p,l,x,n=this;if(f.isPlainObject(c.accept)&&(c.accept=[c.accept]),c.accept){p=[];d=0;for(k=c.accept.length;k>d;d++)(h=c.accept[d].extensions)&&p.push(h);p.length&&(l="\\."+p.join(",").replace(/,/g,"$|\\.").replace(/\*/g,".*")+"$");n.accept=new RegExp(l,"i")}return n.queue=new g,n.stats=n.queue.stats,
"html5"===this.request("predict-runtime-type")?(b=e.Deferred(),x=new a("Placeholder"),x.connectRuntime({runtimeOrder:"html5"},function(){n._ruid=x.getRuid();b.resolve()}),b.promise()):void 0},_wrapFile:function(a){if(!(a instanceof d)){if(!(a instanceof b)){if(!this._ruid)throw Error("Can't add external files.");a=new b(this._ruid,a)}a=new d(a)}return a},acceptFile:function(a){return!(!a||6>a.size||this.accept&&c.exec(a.name)&&!this.accept.test(a.name))},_addFile:function(a){return a=this._wrapFile(a),
this.owner.trigger("beforeFileQueued",a)?this.acceptFile(a)?(this.queue.append(a),this.owner.trigger("fileQueued",a),a):void this.owner.trigger("error","Q_TYPE_DENIED",a):void 0},getFile:function(a){return this.queue.getFile(a)},addFiles:function(a){var c=this;a.length||(a=[a]);a=f.map(a,function(a){return c._addFile(a)});c.owner.trigger("filesQueued",a);c.options.auto&&c.request("start-upload")},getStats:function(){return this.stats},removeFile:function(a){a=a.id?a:this.queue.getFile(a);a.setStatus(k.CANCELLED);
this.owner.trigger("fileDequeued",a)},getFiles:function(){return this.queue.getFiles.apply(this.queue,arguments)},fetchFile:function(){return this.queue.fetch.apply(this.queue,arguments)},retry:function(a,c){var b,f,d;if(a)return a=a.id?a:this.queue.getFile(a),a.setStatus(k.QUEUED),void(c||this.request("start-upload"));b=this.queue.getFiles(k.ERROR);f=0;for(d=b.length;d>f;f++)a=b[f],a.setStatus(k.QUEUED);this.request("start-upload")},sortFiles:function(){return this.queue.sort.apply(this.queue,arguments)},
reset:function(){this.queue=new g;this.stats=this.queue.stats}})}),l("widgets/runtime",["uploader","runtime/runtime","widgets/widget"],function(e,h){return e.support=function(){return h.hasRuntime.apply(h,arguments)},e.register({"predict-runtime-type":"predictRuntmeType"},{init:function(){if(!this.predictRuntmeType())throw Error("Runtime Error");},predictRuntmeType:function(){var e,d,b=this.options.runtimeOrder||h.orders,a=this.type;if(!a)for(b=b.split(/\s*,\s*/g),e=0,d=b.length;d>e;e++)if(h.hasRuntime(b[e])){this.type=
a=b[e];break}return a}})}),l("lib/transport",["base","runtime/client","mediator"],function(e,h,g){function d(a){var f=this;a=f.options=b.extend(!0,{},d.options,a||{});h.call(this,"Transport");this._blob=null;this._formData=a.formData||{};this._headers=a.headers||{};this.on("progress",this._timeout);this.on("load error",function(){f.trigger("progress",1);clearTimeout(f._timer)})}var b=e.$;return d.options={server:"",method:"POST",withCredentials:!1,fileVal:"file",timeout:12E4,formData:{},headers:{},
sendAsBinary:!1},b.extend(d.prototype,{appendBlob:function(a,b,c){var k=this,d=k.options;k.getRuid()&&k.disconnectRuntime();k.connectRuntime(b.ruid,function(){k.exec("init")});k._blob=b;d.fileVal=a||d.fileVal;d.filename=c||d.filename},append:function(a,f){"object"==typeof a?b.extend(this._formData,a):this._formData[a]=f},setRequestHeader:function(a,f){"object"==typeof a?b.extend(this._headers,a):this._headers[a]=f},send:function(a){this.exec("send",a);this._timeout()},abort:function(){return clearTimeout(this._timer),
this.exec("abort")},destroy:function(){this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()},getResponse:function(){return this.exec("getResponse")},getResponseAsJson:function(){return this.exec("getResponseAsJson")},getStatus:function(){return this.exec("getStatus")},_timeout:function(){var a=this,b=a.options.timeout;b&&(clearTimeout(a._timer),a._timer=setTimeout(function(){a.abort();a.trigger("error","timeout")},b))}}),g.installTo(d.prototype),d}),l("widgets/upload",
["base","uploader","file","lib/transport","widgets/widget"],function(e,h,g,d){function b(a,c){for(var b,f=[],d=a.source.size,e=c?Math.ceil(d/c):1,g=0,h=0;e>h;)b=Math.min(c,d-g),f.push({file:a,start:g,end:c?g+b:d,total:d,chunks:e,chunk:h++}),g+=b;return a.blocks=f.concat(),a.remaning=f.length,{file:a,has:function(){return!!f.length},fetch:function(){return f.shift()}}}var a=e.$,f=e.isPromise,c=g.Status;a.extend(h.options,{prepareNextFile:!1,chunked:!1,chunkSize:5242880,chunkRetry:2,threads:3,formData:null});
h.register({"start-upload":"start","stop-upload":"stop","skip-file":"skipFile","is-in-progress":"isInProgress"},{init:function(){var c=this.owner;this.runing=!1;this.pool=[];this.pending=[];this.remaning=0;this.__tick=e.bindFn(this._tick,this);c.on("uploadComplete",function(c){c.blocks&&a.each(c.blocks,function(a,c){c.transport&&(c.transport.abort(),c.transport.destroy());delete c.transport});delete c.blocks;delete c.remaning})},start:function(){var b=this;a.each(b.request("get-files",c.INVALID),
function(){b.request("remove-file",this)});b.runing||(b.runing=!0,a.each(b.pool,function(a,f){var d=f.file;d.getStatus()===c.INTERRUPT&&(d.setStatus(c.PROGRESS),b._trigged=!1,f.transport&&f.transport.send())}),b._trigged=!1,b.owner.trigger("startUpload"),e.nextTick(b.__tick))},stop:function(b){!1!==this.runing&&(this.runing=!1,b&&a.each(this.pool,function(a,b){b.transport&&b.transport.abort();b.file.setStatus(c.INTERRUPT)}),this.owner.trigger("stopUpload"))},isInProgress:function(){return!!this.runing},
getStats:function(){return this.request("get-stats")},skipFile:function(b,f){b=this.request("get-file",b);b.setStatus(f||c.COMPLETE);b.skipped=!0;b.blocks&&a.each(b.blocks,function(a,c){var b=c.transport;b&&(b.abort(),b.destroy(),delete c.transport)});this.owner.trigger("uploadSkip",b)},_tick:function(){var a,c,b=this,d=b.options;return b._promise?b._promise.always(b.__tick):void(b.pool.length<d.threads&&(c=b._nextBlock())?(b._trigged=!1,a=function(a){b._promise=null;a&&a.file&&b._startSend(a);e.nextTick(b.__tick)},
b._promise=f(c)?c.always(a):a(c)):b.remaning||b.getStats().numOfQueue||(b.runing=!1,b._trigged||e.nextTick(function(){b.owner.trigger("uploadFinished")}),b._trigged=!0))},_nextBlock:function(){var a,d,e=this,g=e._act,h=e.options;return g&&g.has()&&g.file.getStatus()===c.PROGRESS?(h.prepareNextFile&&!e.pending.length&&e._prepareNextFile(),g.fetch()):e.runing?(!e.pending.length&&e.getStats().numOfQueue&&e._prepareNextFile(),a=e.pending.shift(),d=function(a){return a?(g=b(a,h.chunked?h.chunkSize:0),
e._act=g,g.fetch()):null},f(a)?a[a.pipe?"pipe":"then"](d):d(a)):void 0},_prepareNextFile:function(){var b,f=this,d=f.request("fetch-file"),e=f.pending;d&&(b=f.request("before-send-file",d,function(){return d.getStatus()===c.QUEUED?(f.owner.trigger("uploadStart",d),d.setStatus(c.PROGRESS),d):f._finishFile(d)}),b.done(function(){var c=a.inArray(b,e);~c&&e.splice(c,1,d)}),b.fail(function(a){d.setStatus(c.ERROR,a);f.owner.trigger("uploadError",d,a);f.owner.trigger("uploadComplete",d)}),e.push(b))},_popBlock:function(b){var c=
a.inArray(b,this.pool);this.pool.splice(c,1);b.file.remaning--;this.remaning--},_startSend:function(a){var b=this,f=a.file;b.pool.push(a);b.remaning++;a.blob=1===a.chunks?f.source:f.source.slice(a.start,a.end);b.request("before-send",a,function(){f.getStatus()===c.PROGRESS?b._doSend(a):(b._popBlock(a),e.nextTick(b.__tick))}).fail(function(){1===f.remaning?b._finishFile(f).always(function(){a.percentage=1;b._popBlock(a);b.owner.trigger("uploadComplete",f);e.nextTick(b.__tick)}):(a.percentage=1,b._popBlock(a),
e.nextTick(b.__tick))})},_doSend:function(b){var f,g,h=this,l=h.owner,r=h.options,p=b.file,q=new d(r),n=a.extend({},r.formData),w=a.extend({},r.headers);b.transport=q;q.on("destroy",function(){delete b.transport;h._popBlock(b);e.nextTick(h.__tick)});q.on("progress",function(c){var f=0,d=0,f=b.percentage=c;1<b.chunks&&(a.each(p.blocks,function(a,b){d+=(b.percentage||0)*(b.end-b.start)}),f=d/p.size);l.trigger("uploadProgress",p,f||0)});f=function(a){var c;return g=q.getResponseAsJson()||{},g._raw=q.getResponse(),
c=function(b){a=b},l.trigger("uploadAccept",b,g,c)||(a=a||"server"),a};q.on("error",function(a,d){b.retried=b.retried||0;1<b.chunks&&~"http,abort".indexOf(a)&&b.retried<r.chunkRetry?(b.retried++,q.send()):(d||"server"!==a||(a=f(a)),p.setStatus(c.ERROR,a),l.trigger("uploadError",p,a),l.trigger("uploadComplete",p))});q.on("load",function(){var a;return(a=f())?void q.trigger("error",a,!0):void(1===p.remaning?h._finishFile(p,g):q.destroy())});n=a.extend(n,{id:p.id,name:p.name,type:p.type,lastModifiedDate:p.lastModifiedDate,
size:p.size});1<b.chunks&&a.extend(n,{chunks:b.chunks,chunk:b.chunk});l.trigger("uploadBeforeSend",b,n,w);q.appendBlob(r.fileVal,b.blob,p.name);q.append(n);q.setRequestHeader(w);q.send()},_finishFile:function(a,b,f){var d=this.owner;return d.request("after-send-file",arguments,function(){a.setStatus(c.COMPLETE);d.trigger("uploadSuccess",a,b,f)}).fail(function(b){a.getStatus()===c.PROGRESS&&a.setStatus(c.ERROR,b);d.trigger("uploadError",a,b)}).always(function(){d.trigger("uploadComplete",a)})}})}),
l("widgets/validator",["base","uploader","file","widgets/widget"],function(e,h,g){var d,b=e.$,a={};return d={addValidator:function(b,c){a[b]=c},removeValidator:function(b){delete a[b]}},h.register({init:function(){var f=this;b.each(a,function(){this.call(f.owner)})}}),d.addValidator("fileNumLimit",function(){var a=0,b=this.options.fileNumLimit>>0,d=!0;b&&(this.on("beforeFileQueued",function(e){return a>=b&&d&&(d=!1,this.trigger("error","Q_EXCEED_NUM_LIMIT",b,e),setTimeout(function(){d=!0},1)),a>=
b?!1:!0}),this.on("fileQueued",function(){a++}),this.on("fileDequeued",function(){a--}),this.on("uploadFinished",function(){a=0}))}),d.addValidator("fileSizeLimit",function(){var a=0,b=this.options.fileSizeLimit>>0,d=!0;b&&(this.on("beforeFileQueued",function(e){var g=a+e.size>b;return g&&d&&(d=!1,this.trigger("error","Q_EXCEED_SIZE_LIMIT",b,e),setTimeout(function(){d=!0},1)),g?!1:!0}),this.on("fileQueued",function(b){a+=b.size}),this.on("fileDequeued",function(b){a-=b.size}),this.on("uploadFinished",
function(){a=0}))}),d.addValidator("fileSingleSizeLimit",function(){var a=this.options.fileSingleSizeLimit;a&&this.on("beforeFileQueued",function(b){return b.size>a?(b.setStatus(g.Status.INVALID,"exceed_size"),this.trigger("error","F_EXCEED_SIZE",b),!1):void 0})}),d.addValidator("duplicate",function(){var a={};this.options.duplicate||(this.on("beforeFileQueued",function(b){var d;if(!(d=b.__hash)){d=b.name+b.size+b.lastModifiedDate;for(var e,g=0,h=0,l=d.length;l>h;h++)e=d.charCodeAt(h),g=e+(g<<6)+
(g<<16)-g;d=b.__hash=g}return a[d]?(this.trigger("error","F_DUPLICATE",b),!1):void 0}),this.on("fileQueued",function(b){(b=b.__hash)&&(a[b]=!0)}),this.on("fileDequeued",function(b){(b=b.__hash)&&delete a[b]}))}),d}),l("runtime/compbase",[],function(){return function(e,h){this.owner=e;this.options=e.options;this.getRuntime=function(){return h};this.getRuid=function(){return h.uid};this.trigger=function(){return e.trigger.apply(e,arguments)}}}),l("runtime/html5/runtime",["base","runtime/runtime","runtime/compbase"],
function(e,h,g){function d(){var d={},c=this,k=this.destory;h.apply(c,arguments);c.type=b;c.exec=function(b,k){var g,h=this.uid,l=e.slice(arguments,2);return a[b]&&(g=d[h]=d[h]||new a[b](this,c),g[k])?g[k].apply(g,l):void 0};c.destory=function(){return k&&k.apply(this,arguments)}}var b="html5",a={};return e.inherits(h,{constructor:d,init:function(){var a=this;setTimeout(function(){a.trigger("ready")},1)}}),d.register=function(b,c){return a[b]=e.inherits(g,c)},n.Blob&&n.FileReader&&n.DataView&&h.addRuntime(b,
d),d}),l("runtime/html5/blob",["runtime/html5/runtime","lib/blob"],function(e,h){return e.register("Blob",{slice:function(e,d){var b=this.owner.source;return b=(b.slice||b.webkitSlice||b.mozSlice).call(b,e,d),new h(this.getRuid(),b)}})}),l("runtime/html5/dnd",["base","runtime/html5/runtime","lib/file"],function(e,h,g){var d=e.$;return h.register("DragAndDrop",{init:function(){var b=this.elem=this.options.container;this.dragEnterHandler=e.bindFn(this._dragEnterHandler,this);this.dragOverHandler=e.bindFn(this._dragOverHandler,
this);this.dragLeaveHandler=e.bindFn(this._dragLeaveHandler,this);this.dropHandler=e.bindFn(this._dropHandler,this);this.dndOver=!1;b.on("dragenter",this.dragEnterHandler);b.on("dragover",this.dragOverHandler);b.on("dragleave",this.dragLeaveHandler);b.on("drop",this.dropHandler);this.options.disableGlobalDnd&&(d(document).on("dragover",this.dragOverHandler),d(document).on("drop",this.dropHandler))},_dragEnterHandler:function(b){var a,d=this._denied||!1;return b=b.originalEvent||b,this.dndOver||(this.dndOver=
!0,a=b.dataTransfer.items,a&&a.length&&(this._denied=d=!this.trigger("accept",a)),this.elem.addClass("webuploader-dnd-over"),this.elem[d?"addClass":"removeClass"]("webuploader-dnd-denied")),b.dataTransfer.dropEffect=d?"none":"copy",!1},_dragOverHandler:function(b){var a=this.elem.parent().get(0);return a&&!d.contains(a,b.currentTarget)?!1:(clearTimeout(this._leaveTimer),this._dragEnterHandler.call(this,b),!1)},_dragLeaveHandler:function(){var b,a=this;return b=function(){a.dndOver=!1;a.elem.removeClass("webuploader-dnd-over webuploader-dnd-denied")},
clearTimeout(a._leaveTimer),a._leaveTimer=setTimeout(b,100),!1},_dropHandler:function(b){var a=this,f=a.getRuid(),c=a.elem.parent().get(0);return c&&!d.contains(c,b.currentTarget)?!1:(a._getTansferFiles(b,function(b){a.trigger("drop",d.map(b,function(a){return new g(f,a)}))}),a.dndOver=!1,a.elem.removeClass("webuploader-dnd-over"),!1)},_getTansferFiles:function(b,a){var d,c,k,g,h,l,n,r=[],p=[];b=b.originalEvent||b;c=b.dataTransfer;d=c.items;c=c.files;n=!(!d||!d[0].webkitGetAsEntry);h=0;for(l=c.length;l>
h;h++)k=c[h],g=d&&d[h],n&&g.webkitGetAsEntry().isDirectory?p.push(this._traverseDirectoryTree(g.webkitGetAsEntry(),r)):r.push(k);e.when.apply(e,p).done(function(){r.length&&a(r)})},_traverseDirectoryTree:function(b,a){var d=e.Deferred(),c=this;return b.isFile?b.file(function(b){a.push(b);d.resolve()}):b.isDirectory&&b.createReader().readEntries(function(b){var g,h=b.length,l=[],n=[];for(g=0;h>g;g++)l.push(c._traverseDirectoryTree(b[g],n));e.when.apply(e,l).then(function(){a.push.apply(a,n);d.resolve()},
d.reject)}),d.promise()},destroy:function(){var b=this.elem;b.off("dragenter",this.dragEnterHandler);b.off("dragover",this.dragEnterHandler);b.off("dragleave",this.dragLeaveHandler);b.off("drop",this.dropHandler);this.options.disableGlobalDnd&&(d(document).off("dragover",this.dragOverHandler),d(document).off("drop",this.dropHandler))}})}),l("runtime/html5/filepaste",["base","runtime/html5/runtime","lib/file"],function(e,h,g){return h.register("FilePaste",{init:function(){var d,b,a,f,c=this.options,
k=this.elem=c.container,g=".*";if(c.accept){d=[];b=0;for(a=c.accept.length;a>b;b++)(f=c.accept[b].mimeTypes)&&d.push(f);d.length&&(g=d.join(","),g=g.replace(/,/g,"|").replace(/\*/g,".*"))}this.accept=new RegExp(g,"i");this.hander=e.bindFn(this._pasteHander,this);k.on("paste",this.hander)},_pasteHander:function(d){var b,a,f,c,e,h=[],l=this.getRuid();d=d.originalEvent||d;b=d.clipboardData.items;c=0;for(e=b.length;e>c;c++)a=b[c],"file"===a.kind&&(f=a.getAsFile())&&h.push(new g(l,f));h.length&&(d.preventDefault(),
d.stopPropagation(),this.trigger("paste",h))},destroy:function(){this.elem.off("paste",this.hander)}})}),l("runtime/html5/filepicker",["base","runtime/html5/runtime"],function(e,h){var g=e.$;return h.register("FilePicker",{init:function(){var d,b,a,f,c=this.getRuntime().getContainer(),e=this,h=e.owner,l=e.options,n=g(document.createElement("label")),t=g(document.createElement("input"));if(t.attr("type","file"),t.attr("name",l.name),t.addClass("webuploader-element-invisible"),n.on("click",function(){t.trigger("click")}),
n.css({opacity:0,width:"100%",height:"100%",display:"block",cursor:"pointer",background:"#ffffff"}),l.multiple&&t.attr("multiple","multiple"),l.accept&&0<l.accept.length){d=[];b=0;for(a=l.accept.length;a>b;b++)d.push(l.accept[b].mimeTypes);t.attr("accept",d.join(","))}c.append(t);c.append(n);f=function(a){h.trigger(a.type)};t.on("change",function(a){var b,c=arguments.callee;e.files=a.target.files;b=this.cloneNode(!0);this.parentNode.replaceChild(b,this);t.off();t=g(b).on("change",c).on("mouseenter mouseleave",
f);h.trigger("change")});n.on("mouseenter mouseleave",f)},getFiles:function(){return this.files},destroy:function(){}})}),l("runtime/html5/transport",["base","runtime/html5/runtime"],function(e,h){var g=e.noop,d=e.$;return h.register("Transport",{init:function(){this._status=0;this._response=null},send:function(){var b,a,f,c=this.owner,k=this.options,g=this._initAjax(),h=c._blob,l=k.server;k.sendAsBinary?(l+=(/\?/.test(l)?"&":"?")+d.param(c._formData),a=h.getSource()):(b=new FormData,d.each(c._formData,
function(a,c){b.append(a,c)}),b.append(k.fileVal,h.getSource(),k.filename||c._formData.name||""));k.withCredentials&&"withCredentials"in g?(g.open(k.method,l,!0),g.withCredentials=!0):g.open(k.method,l);this._setRequestHeader(g,k.headers);a?(g.overrideMimeType("application/octet-stream"),e.os.android?(f=new FileReader,f.onload=function(){g.send(this.result);f=f.onload=null},f.readAsArrayBuffer(a)):g.send(a)):g.send(b)},getResponse:function(){return this._response},getResponseAsJson:function(){return this._parseJson(this._response)},
getStatus:function(){return this._status},abort:function(){var b=this._xhr;b&&(b.upload.onprogress=g,b.onreadystatechange=g,b.abort(),this._xhr=null)},destroy:function(){this.abort()},_initAjax:function(){var b=this,a=new XMLHttpRequest;return!this.options.withCredentials||"withCredentials"in a||"undefined"==typeof XDomainRequest||(a=new XDomainRequest),a.upload.onprogress=function(a){var c=0;return a.lengthComputable&&(c=a.loaded/a.total),b.trigger("progress",c)},a.onreadystatechange=function(){return 4===
a.readyState?(a.upload.onprogress=g,a.onreadystatechange=g,b._xhr=null,b._status=a.status,200<=a.status&&300>a.status?(b._response=a.responseText,b.trigger("load")):500<=a.status&&600>a.status?(b._response=a.responseText,b.trigger("error","server")):b.trigger("error",b._status?"http":"abort")):void 0},b._xhr=a,a},_setRequestHeader:function(b,a){d.each(a,function(a,c){b.setRequestHeader(a,c)})},_parseJson:function(b){var a;try{a=JSON.parse(b)}catch(d){a={}}return a}})}),l("runtime/flash/runtime",["base",
"runtime/runtime","runtime/compbase"],function(e,h,g){function d(){function b(a,c){var d,f;d=a.type||a;d=d.split("::");f=d[0];d=d[1];"Ready"===d&&f===v.uid?v.trigger("ready"):g[f]&&g[f].trigger(d.toLowerCase(),a,c)}var d={},g={},l=this.destory,v=this,t=e.guid("webuploader_");h.apply(v,arguments);v.type=a;v.exec=function(a,b){var c,h=this.uid,l=e.slice(arguments,2);return g[h]=this,f[a]&&(d[h]||(d[h]=new f[a](this,v)),c=d[h],c[b])?c[b].apply(c,l):v.flashExec.apply(this,arguments)};n[t]=function(){var a=
arguments;setTimeout(function(){b.apply(null,a)},1)};this.jsreciver=t;this.destory=function(){return l&&l.apply(this,arguments)};this.flashExec=function(a,b){var c=v.getFlash(),d=e.slice(arguments,2);return c.exec(this.uid,a,b,d)}}var b=e.$,a="flash",f={};return e.inherits(h,{constructor:d,init:function(){var a,b=this.getContainer(),d=this.options;b.css({position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"});a='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+
d.swf+'" ';e.browser.ie&&(a+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" ');a+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+d.swf+'" /><param name="flashvars" value="uid='+this.uid+"&jsreciver="+this.jsreciver+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>';b.html(a)},getFlash:function(){return this._flash?this._flash:(this._flash=b("#"+this.uid).get(0),this._flash)}}),d.register=function(a,d){return d=
f[a]=e.inherits(g,b.extend({flashExec:function(){var a=this.owner;return this.getRuntime().flashExec.apply(a,arguments)}},d))},11.4<=function(){var a;try{a=navigator.plugins["Shockwave Flash"],a=a.description}catch(b){try{a=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(d){a="0.0"}}return a=a.match(/\d+/g),parseFloat(a[0]+"."+a[1],10)}()&&h.addRuntime(a,d),d}),l("runtime/flash/filepicker",["base","runtime/flash/runtime"],function(e,h){var g=e.$;return h.register("FilePicker",
{init:function(d){var b,a=g.extend({},d);d=a.accept&&a.accept.length;for(b=0;d>b;b++)a.accept[b].title||(a.accept[b].title="Files");delete a.button;delete a.container;this.flashExec("FilePicker","init",a)},destroy:function(){}})}),l("runtime/flash/transport",["base","runtime/flash/runtime","runtime/client"],function(e,h,g){var d=e.$;return h.register("Transport",{init:function(){this._status=0;this._responseJson=this._response=null},send:function(){var b,a=this.owner,f=this.options,c=this._initAjax(),
e=a._blob,g=f.server;c.connectRuntime(e.ruid);f.sendAsBinary?(g+=(/\?/.test(g)?"&":"?")+d.param(a._formData),b=e.uid):(d.each(a._formData,function(a,b){c.exec("append",a,b)}),c.exec("appendBlob",f.fileVal,e.uid,f.filename||a._formData.name||""));this._setRequestHeader(c,f.headers);c.exec("send",{method:f.method,url:g},b)},getStatus:function(){return this._status},getResponse:function(){return this._response},getResponseAsJson:function(){return this._responseJson},abort:function(){var b=this._xhr;
b&&(b.exec("abort"),b.destroy(),this._xhr=null)},destroy:function(){this.abort()},_initAjax:function(){var b=this,a=new g("XMLHttpRequest");return a.on("uploadprogress progress",function(a){return b.trigger("progress",a.loaded/a.total)}),a.on("load",function(){var d=a.exec("getStatus"),c="";return a.off(),b._xhr=null,200<=d&&300>d?(b._response=a.exec("getResponse"),b._responseJson=a.exec("getResponseAsJson")):500<=d&&600>d?(b._response=a.exec("getResponse"),b._responseJson=a.exec("getResponseAsJson"),
c="server"):c="http",a.destroy(),a=null,c?b.trigger("error",c):b.trigger("load")}),a.on("error",function(){a.off();b._xhr=null;b.trigger("error","http")}),b._xhr=a,a},_setRequestHeader:function(b,a){d.each(a,function(a,c){b.exec("setRequestHeader",a,c)})}})}),l("preset/withoutimage","base widgets/filednd widgets/filepaste widgets/filepicker widgets/queue widgets/runtime widgets/upload widgets/validator runtime/html5/blob runtime/html5/dnd runtime/html5/filepaste runtime/html5/filepicker runtime/html5/transport runtime/flash/filepicker runtime/flash/transport".split(" "),
function(e){return e}),l("webuploader",["preset/withoutimage"],function(e){return e}),w("webuploader")});