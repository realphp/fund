(function(m,l){var x={},d=function(b,a){var f,c,e;if("string"===typeof b)return h(b);f=[];c=b.length;for(e=0;e<c;e++)f.push(h(b[e]));return a.apply(null,f)},h=function(b){var a=x[b]||m[b];if(!a)throw Error("`"+b+"` is undefined");return a},g=l(m,function(b,a,f){2===arguments.length&&(f=a,a=null);d(a||[],function(){var a=arguments,e={exports:f};"function"===typeof f&&(a.length||(a=[d,e.exports,e]),a=f.apply(null,a),void 0!==a&&(e.exports=a));x[b]=e.exports})},d),c;(function(b){var a,f,c,e,n,t;t=function(a){return a&&
a.charAt(0).toUpperCase()+a.substr(1)};for(a in x)if(f=b,x.hasOwnProperty(a)){c=a.split("/");for(n=t(c.pop());e=t(c.shift());)f[e]=f[e]||{},f=f[e];f[n]=x[a]}})(g);"object"===typeof module&&"object"===typeof module.exports?module.exports=g:"function"===typeof define&&define.amd?define([],g):(c=m.WebUploader,m.WebUploader=g,m.WebUploader.noConflict=function(){m.WebUploader=c})})(this,function(m,l,x){l("dollar-third",[],function(){return m.jQuery||m.Zepto});l("dollar",["dollar-third"],function(d){return d});
l("promise-third",["dollar"],function(d){return{Deferred:d.Deferred,when:d.when,isPromise:function(d){return d&&"function"===typeof d.then}}});l("promise",["promise-third"],function(d){return d});l("base",["dollar","promise"],function(d,h){function g(a,b){return function(){return a.apply(b,arguments)}}function c(a){var b;if(Object.create)return Object.create(a);b=function(){};b.prototype=a;return new b}var b=function(){},a=Function.call,f=h.Deferred,k=h.isPromise,e=h.when,n=function(a){var b={},e=
a.match(/WebKit\/([\d.]+)/),f=a.match(/Chrome\/([\d.]+)/)||a.match(/CriOS\/([\d.]+)/),n=a.match(/MSIE\s([\d\.]+)/)||a.match(/(?:trident)(?:.*rv:([\w.]+))?/i),c=a.match(/Firefox\/([\d.]+)/),k=a.match(/Safari\/([\d.]+)/);a=a.match(/OPR\/([\d.]+)/);e&&(b.webkit=parseFloat(e[1]));f&&(b.chrome=parseFloat(f[1]));n&&(b.ie=parseFloat(n[1]));c&&(b.firefox=parseFloat(c[1]));k&&(b.safari=parseFloat(k[1]));a&&(b.opera=parseFloat(a[1]));return b}(navigator.userAgent),t=function(a){var b={},e=a.match(/(?:Android);?[\s\/]+([\d.]+)?/);
a=a.match(/(?:iPad|iPod|iPhone).*OS\s([\d_]+)/);e&&(b.android=parseFloat(e[1]));a&&(b.ios=parseFloat(a[1].replace(/_/g,".")));return b}(navigator.userAgent),y;y=m.console?g(console.log,console):b;return{version:"0.1.2",$:d,Deferred:f,isPromise:k,when:e,browser:n,os:t,inherits:function(a,b,e){var f;"function"===typeof b?(f=b,b=null):f=b&&b.hasOwnProperty("constructor")?b.constructor:function(){return a.apply(this,arguments)};d.extend(!0,f,a,e||{});f.__super__=a.prototype;f.prototype=c(a.prototype);
b&&d.extend(!0,f.prototype,b);return f},noop:b,bindFn:g,log:y,nextTick:function(){return function(a){setTimeout(a,1)}}(),slice:function(b){return function(){return a.apply(b,arguments)}}([].slice),guid:function(){var a=0;return function(b){for(var e=(+new Date).toString(32),f=0;5>f;f++)e+=Math.floor(65535*Math.random()).toString(32);return(b||"wu_")+e+(a++).toString(32)}}(),formatSize:function(a,b,e){var f;for(e=e||["B","K","M","G","TB"];(f=e.shift())&&1024<a;)a/=1024;return("B"===f?a:a.toFixed(b||
2))+f}}});l("mediator",["base"],function(d){function h(a,f,c,k){return b.grep(a,function(a){return a&&(!f||a.e===f)&&(!c||a.cb===c||a.cb._cb===c)&&(!k||a.ctx===k)})}function g(a,n,c){b.each((a||"").split(f),function(a,b){c(b,n)})}function c(a,b){for(var f=!1,c=-1,k=a.length,d;++c<k;)if(d=a[c],!1===d.cb.apply(d.ctx2,b)){f=!0;break}return!f}var b=d.$,a=[].slice,f=/\s+/,k;k={on:function(a,b,f){var c=this,k;if(!b)return this;k=this._events||(this._events=[]);g(a,b,function(a,b){var e={e:a};e.cb=b;e.ctx=
f;e.ctx2=f||c;e.id=k.length;k.push(e)});return this},once:function(a,b,f){var c=this;if(!b)return c;g(a,b,function(a,b){var e=function(){c.off(a,e);return b.apply(f||c,arguments)};e._cb=b;c.on(a,e,f)});return c},off:function(a,f,c){var k=this._events;if(!k)return this;if(!a&&!f&&!c)return this._events=[],this;g(a,f,function(a,e){b.each(h(k,a,e,c),function(){delete k[this.id]})});return this},trigger:function(b){var f,k,d;if(!this._events||!b)return this;f=a.call(arguments,1);k=h(this._events,b);d=
h(this._events,"all");return c(k,f)&&c(d,arguments)}};return b.extend({installTo:function(a){return b.extend(a,k)}},k)});l("uploader",["base","mediator"],function(d,h){function g(b){this.options=c.extend(!0,{},g.options,b);this._init(this.options)}var c=d.$;g.options={};h.installTo(g.prototype);c.each({upload:"start-upload",stop:"stop-upload",getFile:"get-file",getFiles:"get-files",addFile:"add-file",addFiles:"add-file",sort:"sort-files",removeFile:"remove-file",skipFile:"skip-file",retry:"retry",
isInProgress:"is-in-progress",makeThumb:"make-thumb",getDimension:"get-dimension",addButton:"add-btn",getRuntimeType:"get-runtime-type",refresh:"refresh",disable:"disable",enable:"enable",reset:"reset"},function(b,a){g.prototype[b]=function(){return this.request(a,arguments)}});c.extend(g.prototype,{state:"pending",_init:function(b){var a=this;a.request("init",b,function(){a.state="ready";a.trigger("ready")})},option:function(b,a){var f=this.options;if(1<arguments.length)c.isPlainObject(a)&&c.isPlainObject(f[b])?
c.extend(f[b],a):f[b]=a;else return b?f[b]:f},getStats:function(){var b=this.request("get-stats");return{successNum:b.numOfSuccess,cancelNum:b.numOfCancel,invalidNum:b.numOfInvalid,uploadFailNum:b.numOfUploadFailed,queueNum:b.numOfQueue}},trigger:function(b){var a=[].slice.call(arguments,1),f=this.options,k="on"+b.substring(0,1).toUpperCase()+b.substring(1);return!1===h.trigger.apply(this,arguments)||c.isFunction(f[k])&&!1===f[k].apply(this,a)||c.isFunction(this[k])&&!1===this[k].apply(this,a)||!1===
h.trigger.apply(h,[this,b].concat(a))?!1:!0},request:d.noop});d.create=g.create=function(b){return new g(b)};return d.Uploader=g});l("runtime/runtime",["base","mediator"],function(d,h){function g(a){this.options=c.extend({container:document.body},a);this.uid=d.guid("rt_")}var c=d.$,b={},a=function(a){for(var b in a)if(a.hasOwnProperty(b))return b;return null};c.extend(g.prototype,{getContainer:function(){var a,b;if(this._container)return this._container;a=c(this.options.container||document.body);
b=c(document.createElement("div"));b.attr("id","rt_"+this.uid);b.css({position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"});a.append(b);a.addClass("webuploader-container");return this._container=b},init:d.noop,exec:d.noop,destroy:function(){this._container&&this._container.parentNode.removeChild(this.__container);this.off()}});g.orders="html5,flash";g.addRuntime=function(a,c){b[a]=c};g.hasRuntime=function(f){return!(f?!b[f]:!a(b))};g.create=function(f,k){var e;k=k||
g.orders;c.each(k.split(/\s*,\s*/g),function(){if(b[this])return e=this,!1});e=e||a(b);if(!e)throw Error("Runtime Error");return new b[e](f)};h.installTo(g.prototype);return g});l("runtime/client",["base","mediator","runtime/runtime"],function(d,h,g){function c(a,f){var c=d.Deferred(),e;this.uid=d.guid("client_");this.runtimeReady=function(a){return c.done(a)};this.connectRuntime=function(a,t){if(e)throw Error("already connected!");c.done(t);"string"===typeof a&&b.get(a)&&(e=b.get(a));(e=e||b.get(null,
f))?(d.$.extend(e.options,a),e.__promise.then(c.resolve),e.__client++):(e=g.create(a,a.runtimeOrder),e.__promise=c.promise(),e.once("ready",c.resolve),e.init(),b.add(e),e.__client=1);f&&(e.__standalone=f);return e};this.getRuntime=function(){return e};this.disconnectRuntime=function(){e&&(e.__client--,0>=e.__client&&(b.remove(e),delete e.__promise,e.destroy()),e=null)};this.exec=function(){if(e){var b=d.slice(arguments);a&&b.unshift(a);return e.exec.apply(this,b)}};this.getRuid=function(){return e&&
e.uid};this.destroy=function(a){return function(){a&&a.apply(this,arguments);this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()}}(this.destroy)}var b;b=function(){var a={};return{add:function(b){a[b.uid]=b},get:function(b,c){var e;if(b)return a[b];for(e in a)if(!c||!a[e].__standalone)return a[e];return null},remove:function(b){delete a[b.uid]}}}();h.installTo(c.prototype);return c});l("lib/dnd",["base","mediator","runtime/client"],function(d,h,g){function c(a){a=this.options=
b.extend({},c.options,a);a.container=b(a.container);a.container.length&&g.call(this,"DragAndDrop")}var b=d.$;c.options={accept:null,disableGlobalDnd:!1};d.inherits(g,{constructor:c,init:function(){var a=this;a.connectRuntime(a.options,function(){a.exec("init");a.trigger("ready")})},destroy:function(){this.disconnectRuntime()}});h.installTo(c.prototype);return c});l("widgets/widget",["base","uploader"],function(d,h){function g(a){if(!a)return!1;var f=a.length,c=b.type(a);return 1===a.nodeType&&f?!0:
"array"===c||"function"!==c&&"string"!==c&&(0===f||"number"===typeof f&&0<f&&f-1 in a)}function c(a){this.owner=a;this.options=a.options}var b=d.$,a=h.prototype._init,f={},k=[];b.extend(c.prototype,{init:d.noop,invoke:function(a,c){var k=this.responseMap;return k&&a in k&&k[a]in this&&b.isFunction(this[k[a]])?this[k[a]].apply(this,c):f},request:function(){return this.owner.request.apply(this.owner,arguments)}});b.extend(h.prototype,{_init:function(){var e=this,f=e._widgets=[];b.each(k,function(a,
b){f.push(new b(e))});return a.apply(e,arguments)},request:function(a,b,c){var k=0,h=this._widgets,v=h.length,l=[],r=[],m;for(b=g(b)?b:[b];k<v;k++)m=h[k],m=m.invoke(a,b),m!==f&&(d.isPromise(m)?r.push(m):l.push(m));return c||r.length?(a=d.when.apply(d,r),b=a.pipe?"pipe":"then",a[b](function(){var a=d.Deferred(),b=arguments;setTimeout(function(){a.resolve.apply(a,b)},1);return a.promise()})[b](c||d.noop)):l[0]}});h.register=c.register=function(a,f){var t={init:"init"};1===arguments.length?(f=a,f.responseMap=
t):f.responseMap=b.extend(t,a);t=d.inherits(c,f);k.push(t);return t};return c});l("widgets/filednd",["base","uploader","lib/dnd","widgets/widget"],function(d,h,g){var c=d.$;h.options.dnd="";return h.register({init:function(b){if(b.dnd&&"html5"===this.request("predict-runtime-type")){var a=this,f=d.Deferred();b=c.extend({},{disableGlobalDnd:b.disableGlobalDnd,container:b.dnd,accept:b.accept});b=new g(b);b.once("ready",f.resolve);b.on("drop",function(b){a.request("add-file",[b])});b.on("accept",function(b){return a.owner.trigger("dndAccept",
b)});b.init();return f.promise()}}})});l("lib/filepaste",["base","mediator","runtime/client"],function(d,h,g){function c(a){a=this.options=b.extend({},a);a.container=b(a.container||document.body);g.call(this,"FilePaste")}var b=d.$;d.inherits(g,{constructor:c,init:function(){var a=this;a.connectRuntime(a.options,function(){a.exec("init");a.trigger("ready")})},destroy:function(){this.exec("destroy");this.disconnectRuntime();this.off()}});h.installTo(c.prototype);return c});l("widgets/filepaste",["base",
"uploader","lib/filepaste","widgets/widget"],function(d,h,g){var c=d.$;return h.register({init:function(b){if(b.paste&&"html5"===this.request("predict-runtime-type")){var a=this,f=d.Deferred();b=c.extend({},{container:b.paste,accept:b.accept});b=new g(b);b.once("ready",f.resolve);b.on("paste",function(b){a.owner.request("add-file",[b])});b.init();return f.promise()}}})});l("lib/blob",["base","runtime/client"],function(d,h){function g(c,b){this.source=b;this.ruid=c;h.call(this,"Blob");this.uid=b.uid||
this.uid;this.type=b.type||"";this.size=b.size||0;c&&this.connectRuntime(c)}d.inherits(h,{constructor:g,slice:function(c,b){return this.exec("slice",c,b)},getSource:function(){return this.source}});return g});l("lib/file",["base","lib/blob"],function(d,h){function g(a,f){var k;h.apply(this,arguments);this.name=f.name||"untitled"+c++;k=b.exec(f.name)?RegExp.$1.toLowerCase():"";!k&&this.type&&(k=/\/(jpg|jpeg|png|gif|bmp)$/i.exec(this.type)?RegExp.$1.toLowerCase():"",this.name+="."+k);!this.type&&~"jpg,jpeg,png,gif,bmp".indexOf(k)&&
(this.type="image/"+("jpg"===k?"jpeg":k));this.ext=k;this.lastModifiedDate=f.lastModifiedDate||(new Date).toLocaleString()}var c=1,b=/\.([^.]+)$/;return d.inherits(h,g)});l("lib/filepicker",["base","runtime/client","lib/file"],function(d,h,g){function c(a){a=this.options=b.extend({},c.options,a);a.container=b(a.id);if(!a.container.length)throw Error("\u6309\u94ae\u6307\u5b9a\u9519\u8bef");a.innerHTML=a.innerHTML||a.label||a.container.html()||"";a.button=b(a.button||document.createElement("div"));
a.button.html(a.innerHTML);a.container.html(a.button);h.call(this,"FilePicker",!0)}var b=d.$;c.options={button:null,container:null,label:null,innerHTML:null,multiple:!0,accept:null,name:"file"};d.inherits(h,{constructor:c,init:function(){var a=this,f=a.options,c=f.button;c.addClass("webuploader-pick");a.on("all",function(e){switch(e){case "mouseenter":c.addClass("webuploader-pick-hover");break;case "mouseleave":c.removeClass("webuploader-pick-hover");break;case "change":e=a.exec("getFiles"),a.trigger("select",
b.map(e,function(b){b=new g(a.getRuid(),b);b._refer=f.container;return b}),f.container)}});a.connectRuntime(f,function(){a.refresh();a.exec("init",f);a.trigger("ready")});b(m).on("resize",function(){a.refresh()})},refresh:function(){var a=this.getRuntime().getContainer(),b=this.options.button,c=b.outerWidth?b.outerWidth():b.width(),e=b.outerHeight?b.outerHeight():b.height(),b=b.offset();c&&e&&a.css({bottom:"auto",right:"auto",width:c+"px",height:e+"px"}).offset(b)},enable:function(){this.options.button.removeClass("webuploader-pick-disable");
this.refresh()},disable:function(){var a=this.options.button;this.getRuntime().getContainer().css({top:"-99999px"});a.addClass("webuploader-pick-disable")},destroy:function(){this.runtime&&(this.exec("destroy"),this.disconnectRuntime())}});return c});l("widgets/filepicker",["base","uploader","lib/filepicker","widgets/widget"],function(d,h,g){var c=d.$;c.extend(h.options,{pick:null,accept:null});return h.register({"add-btn":"addButton",refresh:"refresh",disable:"disable",enable:"enable"},{init:function(b){this.pickers=
[];return b.pick&&this.addButton(b.pick)},refresh:function(){c.each(this.pickers,function(){this.refresh()})},addButton:function(b){var a=this,f=a.options,k=f.accept,e;if(b)return e=d.Deferred(),c.isPlainObject(b)||(b={id:b}),b=c.extend({},b,{accept:c.isPlainObject(k)?[k]:k,swf:f.swf,runtimeOrder:f.runtimeOrder}),b=new g(b),b.once("ready",e.resolve),b.on("select",function(b){a.owner.request("add-file",[b])}),b.init(),this.pickers.push(b),e.promise()},disable:function(){c.each(this.pickers,function(){this.disable()})},
enable:function(){c.each(this.pickers,function(){this.enable()})}})});l("lib/image",["base","runtime/client","lib/blob"],function(d,h,g){function c(a){this.options=b.extend({},c.options,a);h.call(this,"Image");this.on("load",function(){this._info=this.exec("info");this._meta=this.exec("meta")})}var b=d.$;c.options={quality:90,crop:!1,preserveHeaders:!0,allowMagnify:!0};d.inherits(h,{constructor:c,info:function(a){return a?(this._info=a,this):this._info},meta:function(a){return a?(this._meta=a,this):
this._meta},loadFromBlob:function(a){var b=this,c=a.getRuid();this.connectRuntime(c,function(){b.exec("init",b.options);b.exec("loadFromBlob",a)})},resize:function(){var a=d.slice(arguments);return this.exec.apply(this,["resize"].concat(a))},getAsDataUrl:function(a){return this.exec("getAsDataUrl",a)},getAsBlob:function(a){a=this.exec("getAsBlob",a);return new g(this.getRuid(),a)}});return c});l("widgets/image",["base","uploader","lib/image","widgets/widget"],function(d,h,g){var c=d.$,b;b=function(a){var b=
0,c=[],e=function(){for(var e;c.length&&b<a;)e=c.shift(),b+=e[0],e[1]()};return function(a,d,g){c.push([d,g]);a.once("destroy",function(){b-=d;setTimeout(e,1)});setTimeout(e,1)}}(5242880);c.extend(h.options,{thumb:{width:110,height:110,quality:70,allowMagnify:!0,crop:!0,preserveHeaders:!1,type:"image/jpeg"},compress:{width:1600,height:1600,quality:90,allowMagnify:!1,crop:!1,preserveHeaders:!0}});return h.register({"make-thumb":"makeThumb","before-send-file":"compressImage"},{makeThumb:function(a,
f,k,e){var n,d;a=this.request("get-file",a);a.type.match(/^image/)?(n=c.extend({},this.options.thumb),c.isPlainObject(k)&&(n=c.extend(n,k),k=null),k=k||n.width,e=e||n.height,d=new g(n),d.once("load",function(){a._info=a._info||d.info();a._meta=a._meta||d.meta();d.resize(k,e)}),d.once("complete",function(){f(!1,d.getAsDataUrl(n.type));d.destroy()}),d.once("error",function(){f(!0);d.destroy()}),b(d,a.source.size,function(){a._info&&d.info(a._info);a._meta&&d.meta(a._meta);d.loadFromBlob(a.source)})):
f(!0)},compressImage:function(a){var b=this.options.compress||this.options.resize,k=b&&b.compressSize||307200,e,n;a=this.request("get-file",a);if(b&&~"image/jpeg,image/jpg".indexOf(a.type)&&!(a.size<k)&&!a._compressed)return b=c.extend({},b),n=d.Deferred(),e=new g(b),n.always(function(){e.destroy();e=null}),e.once("error",n.reject),e.once("load",function(){a._info=a._info||e.info();a._meta=a._meta||e.meta();e.resize(b.width,b.height)}),e.once("complete",function(){var c,k;try{c=e.getAsBlob(b.type),
k=a.size,c.size<k&&(a.source=c,a.size=c.size,a.trigger("resize",c.size,k)),a._compressed=!0,n.resolve()}catch(d){n.resolve()}}),a._info&&e.info(a._info),a._meta&&e.meta(a._meta),e.loadFromBlob(a.source),n.promise()}})});l("file",["base","mediator"],function(d,h){function g(f){this.name=f.name||"Untitled";this.size=f.size||0;this.type=f.type||"application";this.lastModifiedDate=f.lastModifiedDate||1*new Date;this.id="WU_FILE_"+c++;this.ext=b.exec(this.name)?RegExp.$1:"";this.statusText="";a[this.id]=
g.Status.INITED;this.source=f;this.loaded=0;this.on("error",function(a){this.setStatus(g.Status.ERROR,a)})}var c=0,b=/\.([^.]+)$/,a={};d.$.extend(g.prototype,{setStatus:function(b,c){var e=a[this.id];"undefined"!==typeof c&&(this.statusText=c);b!==e&&(a[this.id]=b,this.trigger("statuschange",b,e))},getStatus:function(){return a[this.id]},getSource:function(){return this.source},destory:function(){delete a[this.id]}});h.installTo(g.prototype);g.Status={INITED:"inited",QUEUED:"queued",PROGRESS:"progress",
ERROR:"error",COMPLETE:"complete",CANCELLED:"cancelled",INTERRUPT:"interrupt",INVALID:"invalid"};return g});l("queue",["base","mediator","file"],function(d,h,g){function c(){this.stats={numOfQueue:0,numOfSuccess:0,numOfCancel:0,numOfProgress:0,numOfUploadFailed:0,numOfInvalid:0};this._queue=[];this._map={}}var b=d.$,a=g.Status;b.extend(c.prototype,{append:function(a){this._queue.push(a);this._fileAdded(a);return this},prepend:function(a){this._queue.unshift(a);this._fileAdded(a);return this},getFile:function(a){return"string"!==
typeof a?a:this._map[a]},fetch:function(b){var c=this._queue.length,e,n;b=b||a.QUEUED;for(e=0;e<c;e++)if(n=this._queue[e],b===n.getStatus())return n;return null},sort:function(a){"function"===typeof a&&this._queue.sort(a)},getFiles:function(){for(var a=[].slice.call(arguments,0),c=[],e=0,n=this._queue.length,d;e<n;e++)d=this._queue[e],a.length&&!~b.inArray(d.getStatus(),a)||c.push(d);return c},_fileAdded:function(b){var c=this;this._map[b.id]||(this._map[b.id]=b,b.on("statuschange",function(a,b){c._onFileStatusChange(a,
b)}));b.setStatus(a.QUEUED)},_onFileStatusChange:function(b,c){var e=this.stats;switch(c){case a.PROGRESS:e.numOfProgress--;break;case a.QUEUED:e.numOfQueue--;break;case a.ERROR:e.numOfUploadFailed--;break;case a.INVALID:e.numOfInvalid--}switch(b){case a.QUEUED:e.numOfQueue++;break;case a.PROGRESS:e.numOfProgress++;break;case a.ERROR:e.numOfUploadFailed++;break;case a.COMPLETE:e.numOfSuccess++;break;case a.CANCELLED:e.numOfCancel++;break;case a.INVALID:e.numOfInvalid++}}});h.installTo(c.prototype);
return c});l("widgets/queue","base uploader queue file lib/file runtime/client widgets/widget".split(" "),function(d,h,g,c,b,a){var f=d.$,k=/\.\w+$/,e=c.Status;return h.register({"sort-files":"sortFiles","add-file":"addFiles","get-file":"getFile","fetch-file":"fetchFile","get-stats":"getStats","get-files":"getFiles","remove-file":"removeFile",retry:"retry",reset:"reset","accept-file":"acceptFile"},{init:function(b){var e=this,c,k,h,l,m,w,u;f.isPlainObject(b.accept)&&(b.accept=[b.accept]);if(b.accept){m=
[];h=0;for(k=b.accept.length;h<k;h++)(l=b.accept[h].extensions)&&m.push(l);m.length&&(w="\\."+m.join(",").replace(/,/g,"$|\\.").replace(/\*/g,".*")+"$");e.accept=new RegExp(w,"i")}e.queue=new g;e.stats=e.queue.stats;if("html5"===this.request("predict-runtime-type"))return c=d.Deferred(),u=new a("Placeholder"),u.connectRuntime({runtimeOrder:"html5"},function(){e._ruid=u.getRuid();c.resolve()}),c.promise()},_wrapFile:function(a){if(!(a instanceof c)){if(!(a instanceof b)){if(!this._ruid)throw Error("Can't add external files.");
a=new b(this._ruid,a)}a=new c(a)}return a},acceptFile:function(a){return!(!a||6>a.size||this.accept&&k.exec(a.name)&&!this.accept.test(a.name))},_addFile:function(a){a=this._wrapFile(a);if(this.owner.trigger("beforeFileQueued",a)){if(this.acceptFile(a))return this.queue.append(a),this.owner.trigger("fileQueued",a),a;this.owner.trigger("error","Q_TYPE_DENIED",a)}},getFile:function(a){return this.queue.getFile(a)},addFiles:function(a){var b=this;a.length||(a=[a]);a=f.map(a,function(a){return b._addFile(a)});
b.owner.trigger("filesQueued",a);b.options.auto&&b.request("start-upload")},getStats:function(){return this.stats},removeFile:function(a){a=a.id?a:this.queue.getFile(a);a.setStatus(e.CANCELLED);this.owner.trigger("fileDequeued",a)},getFiles:function(){return this.queue.getFiles.apply(this.queue,arguments)},fetchFile:function(){return this.queue.fetch.apply(this.queue,arguments)},retry:function(a,b){var c,f,k;if(a)a=a.id?a:this.queue.getFile(a),a.setStatus(e.QUEUED),b||this.request("start-upload");
else{c=this.queue.getFiles(e.ERROR);f=0;for(k=c.length;f<k;f++)a=c[f],a.setStatus(e.QUEUED);this.request("start-upload")}},sortFiles:function(){return this.queue.sort.apply(this.queue,arguments)},reset:function(){this.queue=new g;this.stats=this.queue.stats}})});l("widgets/runtime",["uploader","runtime/runtime","widgets/widget"],function(d,h){d.support=function(){return h.hasRuntime.apply(h,arguments)};return d.register({"predict-runtime-type":"predictRuntmeType"},{init:function(){if(!this.predictRuntmeType())throw Error("Runtime Error");
},predictRuntmeType:function(){var d=this.options.runtimeOrder||h.orders,c=this.type,b,a;if(!c)for(d=d.split(/\s*,\s*/g),b=0,a=d.length;b<a;b++)if(h.hasRuntime(d[b])){this.type=c=d[b];break}return c}})});l("lib/transport",["base","runtime/client","mediator"],function(d,h,g){function c(a){var f=this;a=f.options=b.extend(!0,{},c.options,a||{});h.call(this,"Transport");this._blob=null;this._formData=a.formData||{};this._headers=a.headers||{};this.on("progress",this._timeout);this.on("load error",function(){f.trigger("progress",
1);clearTimeout(f._timer)})}var b=d.$;c.options={server:"",method:"POST",withCredentials:!1,fileVal:"file",timeout:12E4,formData:{},headers:{},sendAsBinary:!1};b.extend(c.prototype,{appendBlob:function(a,b,c){var e=this,d=e.options;e.getRuid()&&e.disconnectRuntime();e.connectRuntime(b.ruid,function(){e.exec("init")});e._blob=b;d.fileVal=a||d.fileVal;d.filename=c||d.filename},append:function(a,c){"object"===typeof a?b.extend(this._formData,a):this._formData[a]=c},setRequestHeader:function(a,c){"object"===
typeof a?b.extend(this._headers,a):this._headers[a]=c},send:function(a){this.exec("send",a);this._timeout()},abort:function(){clearTimeout(this._timer);return this.exec("abort")},destroy:function(){this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()},getResponse:function(){return this.exec("getResponse")},getResponseAsJson:function(){return this.exec("getResponseAsJson")},getStatus:function(){return this.exec("getStatus")},_timeout:function(){var a=this,b=a.options.timeout;
b&&(clearTimeout(a._timer),a._timer=setTimeout(function(){a.abort();a.trigger("error","timeout")},b))}});g.installTo(c.prototype);return c});l("widgets/upload",["base","uploader","file","lib/transport","widgets/widget"],function(d,h,g,c){function b(a,b){for(var c=[],f=a.source.size,k=b?Math.ceil(f/b):1,d=0,g=0,h;g<k;)h=Math.min(b,f-d),c.push({file:a,start:d,end:b?d+h:f,total:f,chunks:k,chunk:g++}),d+=h;a.blocks=c.concat();a.remaning=c.length;return{file:a,has:function(){return!!c.length},fetch:function(){return c.shift()}}}
var a=d.$,f=d.isPromise,k=g.Status;a.extend(h.options,{prepareNextFile:!1,chunked:!1,chunkSize:5242880,chunkRetry:2,threads:3,formData:null});h.register({"start-upload":"start","stop-upload":"stop","skip-file":"skipFile","is-in-progress":"isInProgress"},{init:function(){var b=this.owner;this.runing=!1;this.pool=[];this.pending=[];this.remaning=0;this.__tick=d.bindFn(this._tick,this);b.on("uploadComplete",function(b){b.blocks&&a.each(b.blocks,function(a,b){b.transport&&(b.transport.abort(),b.transport.destroy());
delete b.transport});delete b.blocks;delete b.remaning})},start:function(){var b=this;a.each(b.request("get-files",k.INVALID),function(){b.request("remove-file",this)});b.runing||(b.runing=!0,a.each(b.pool,function(a,c){var f=c.file;f.getStatus()===k.INTERRUPT&&(f.setStatus(k.PROGRESS),b._trigged=!1,c.transport&&c.transport.send())}),b._trigged=!1,b.owner.trigger("startUpload"),d.nextTick(b.__tick))},stop:function(b){!1!==this.runing&&(this.runing=!1,b&&a.each(this.pool,function(a,b){b.transport&&
b.transport.abort();b.file.setStatus(k.INTERRUPT)}),this.owner.trigger("stopUpload"))},isInProgress:function(){return!!this.runing},getStats:function(){return this.request("get-stats")},skipFile:function(b,c){b=this.request("get-file",b);b.setStatus(c||k.COMPLETE);b.skipped=!0;b.blocks&&a.each(b.blocks,function(a,b){var c=b.transport;c&&(c.abort(),c.destroy(),delete b.transport)});this.owner.trigger("uploadSkip",b)},_tick:function(){var a=this,b=a.options,c;if(a._promise)return a._promise.always(a.__tick);
a.pool.length<b.threads&&(c=a._nextBlock())?(a._trigged=!1,b=function(b){a._promise=null;b&&b.file&&a._startSend(b);d.nextTick(a.__tick)},a._promise=f(c)?c.always(b):b(c)):a.remaning||a.getStats().numOfQueue||(a.runing=!1,a._trigged||d.nextTick(function(){a.owner.trigger("uploadFinished")}),a._trigged=!0)},_nextBlock:function(){var a=this,c=a._act,d=a.options,g,h;if(c&&c.has()&&c.file.getStatus()===k.PROGRESS)return d.prepareNextFile&&!a.pending.length&&a._prepareNextFile(),c.fetch();if(a.runing)return!a.pending.length&&
a.getStats().numOfQueue&&a._prepareNextFile(),g=a.pending.shift(),h=function(f){if(!f)return null;c=b(f,d.chunked?d.chunkSize:0);a._act=c;return c.fetch()},f(g)?g[g.pipe?"pipe":"then"](h):h(g)},_prepareNextFile:function(){var b=this,c=b.request("fetch-file"),f=b.pending,d;c&&(d=b.request("before-send-file",c,function(){return c.getStatus()===k.QUEUED?(b.owner.trigger("uploadStart",c),c.setStatus(k.PROGRESS),c):b._finishFile(c)}),d.done(function(){var b=a.inArray(d,f);~b&&f.splice(b,1,c)}),d.fail(function(a){c.setStatus(k.ERROR,
a);b.owner.trigger("uploadError",c,a);b.owner.trigger("uploadComplete",c)}),f.push(d))},_popBlock:function(b){var c=a.inArray(b,this.pool);this.pool.splice(c,1);b.file.remaning--;this.remaning--},_startSend:function(a){var b=this,c=a.file;b.pool.push(a);b.remaning++;a.blob=1===a.chunks?c.source:c.source.slice(a.start,a.end);b.request("before-send",a,function(){c.getStatus()===k.PROGRESS?b._doSend(a):(b._popBlock(a),d.nextTick(b.__tick))}).fail(function(){1===c.remaning?b._finishFile(c).always(function(){a.percentage=
1;b._popBlock(a);b.owner.trigger("uploadComplete",c);d.nextTick(b.__tick)}):(a.percentage=1,b._popBlock(a),d.nextTick(b.__tick))})},_doSend:function(b){var f=this,g=f.owner,h=f.options,l=b.file,m=new c(h),p=a.extend({},h.formData),r=a.extend({},h.headers),w,u;b.transport=m;m.on("destroy",function(){delete b.transport;f._popBlock(b);d.nextTick(f.__tick)});m.on("progress",function(c){var f=0,d=0,f=b.percentage=c;1<b.chunks&&(a.each(l.blocks,function(a,b){d+=(b.percentage||0)*(b.end-b.start)}),f=d/l.size);
g.trigger("uploadProgress",l,f||0)});w=function(a){u=m.getResponseAsJson()||{};u._raw=m.getResponse();g.trigger("uploadAccept",b,u,function(b){a=b})||(a=a||"server");return a};m.on("error",function(a,c){b.retried=b.retried||0;1<b.chunks&&~"http,abort".indexOf(a)&&b.retried<h.chunkRetry?(b.retried++,m.send()):(c||"server"!==a||(a=w(a)),l.setStatus(k.ERROR,a),g.trigger("uploadError",l,a),g.trigger("uploadComplete",l))});m.on("load",function(){var a;(a=w())?m.trigger("error",a,!0):1===l.remaning?f._finishFile(l,
u):m.destroy()});p=a.extend(p,{id:l.id,name:l.name,type:l.type,lastModifiedDate:l.lastModifiedDate,size:l.size});1<b.chunks&&a.extend(p,{chunks:b.chunks,chunk:b.chunk});g.trigger("uploadBeforeSend",b,p,r);m.appendBlob(h.fileVal,b.blob,l.name);m.append(p);m.setRequestHeader(r);m.send()},_finishFile:function(a,b,c){var f=this.owner;return f.request("after-send-file",arguments,function(){a.setStatus(k.COMPLETE);f.trigger("uploadSuccess",a,b,c)}).fail(function(b){a.getStatus()===k.PROGRESS&&a.setStatus(k.ERROR,
b);f.trigger("uploadError",a,b)}).always(function(){f.trigger("uploadComplete",a)})}})});l("widgets/validator",["base","uploader","file","widgets/widget"],function(d,h,g){var c=d.$,b={};d={addValidator:function(a,c){b[a]=c},removeValidator:function(a){delete b[a]}};h.register({init:function(){var a=this;c.each(b,function(){this.call(a.owner)})}});d.addValidator("fileNumLimit",function(){var a=0,b=this.options.fileNumLimit>>0,c=!0;b&&(this.on("beforeFileQueued",function(e){a>=b&&c&&(c=!1,this.trigger("error",
"Q_EXCEED_NUM_LIMIT",b,e),setTimeout(function(){c=!0},1));return a>=b?!1:!0}),this.on("fileQueued",function(){a++}),this.on("fileDequeued",function(){a--}),this.on("uploadFinished",function(){a=0}))});d.addValidator("fileSizeLimit",function(){var a=0,b=this.options.fileSizeLimit>>0,c=!0;b&&(this.on("beforeFileQueued",function(e){var d=a+e.size>b;d&&c&&(c=!1,this.trigger("error","Q_EXCEED_SIZE_LIMIT",b,e),setTimeout(function(){c=!0},1));return d?!1:!0}),this.on("fileQueued",function(b){a+=b.size}),
this.on("fileDequeued",function(b){a-=b.size}),this.on("uploadFinished",function(){a=0}))});d.addValidator("fileSingleSizeLimit",function(){var a=this.options.fileSingleSizeLimit;if(a)this.on("beforeFileQueued",function(b){if(b.size>a)return b.setStatus(g.Status.INVALID,"exceed_size"),this.trigger("error","F_EXCEED_SIZE",b),!1})});d.addValidator("duplicate",function(){var a={};this.options.duplicate||(this.on("beforeFileQueued",function(b){var c;if(!(c=b.__hash)){c=b.name+b.size+b.lastModifiedDate;
for(var e=0,d=0,g=c.length,h;d<g;d++)h=c.charCodeAt(d),e=h+(e<<6)+(e<<16)-e;c=b.__hash=e}if(a[c])return this.trigger("error","F_DUPLICATE",b),!1}),this.on("fileQueued",function(b){(b=b.__hash)&&(a[b]=!0)}),this.on("fileDequeued",function(b){(b=b.__hash)&&delete a[b]}))});return d});l("runtime/compbase",[],function(){return function(d,h){this.owner=d;this.options=d.options;this.getRuntime=function(){return h};this.getRuid=function(){return h.uid};this.trigger=function(){return d.trigger.apply(d,arguments)}}});
l("runtime/html5/runtime",["base","runtime/runtime","runtime/compbase"],function(d,h,g){function c(){var a={},c=this,k=this.destory;h.apply(c,arguments);c.type="html5";c.exec=function(e,k){var g=this.uid,h=d.slice(arguments,2);if(b[e]&&(g=a[g]=a[g]||new b[e](this,c),g[k]))return g[k].apply(g,h)};c.destory=function(){return k&&k.apply(this,arguments)}}var b={};d.inherits(h,{constructor:c,init:function(){var a=this;setTimeout(function(){a.trigger("ready")},1)}});c.register=function(a,c){return b[a]=
d.inherits(g,c)};m.Blob&&m.FileReader&&m.DataView&&h.addRuntime("html5",c);return c});l("runtime/html5/blob",["runtime/html5/runtime","lib/blob"],function(d,h){return d.register("Blob",{slice:function(d,c){var b=this.owner.source,b=(b.slice||b.webkitSlice||b.mozSlice).call(b,d,c);return new h(this.getRuid(),b)}})});l("runtime/html5/dnd",["base","runtime/html5/runtime","lib/file"],function(d,h,g){var c=d.$;return h.register("DragAndDrop",{init:function(){var b=this.elem=this.options.container;this.dragEnterHandler=
d.bindFn(this._dragEnterHandler,this);this.dragOverHandler=d.bindFn(this._dragOverHandler,this);this.dragLeaveHandler=d.bindFn(this._dragLeaveHandler,this);this.dropHandler=d.bindFn(this._dropHandler,this);this.dndOver=!1;b.on("dragenter",this.dragEnterHandler);b.on("dragover",this.dragOverHandler);b.on("dragleave",this.dragLeaveHandler);b.on("drop",this.dropHandler);this.options.disableGlobalDnd&&(c(document).on("dragover",this.dragOverHandler),c(document).on("drop",this.dropHandler))},_dragEnterHandler:function(b){var a=
this._denied||!1,c;b=b.originalEvent||b;this.dndOver||(this.dndOver=!0,(c=b.dataTransfer.items)&&c.length&&(this._denied=a=!this.trigger("accept",c)),this.elem.addClass("webuploader-dnd-over"),this.elem[a?"addClass":"removeClass"]("webuploader-dnd-denied"));b.dataTransfer.dropEffect=a?"none":"copy";return!1},_dragOverHandler:function(b){var a=this.elem.parent().get(0);if(a&&!c.contains(a,b.currentTarget))return!1;clearTimeout(this._leaveTimer);this._dragEnterHandler.call(this,b);return!1},_dragLeaveHandler:function(){var b=
this;clearTimeout(b._leaveTimer);b._leaveTimer=setTimeout(function(){b.dndOver=!1;b.elem.removeClass("webuploader-dnd-over webuploader-dnd-denied")},100);return!1},_dropHandler:function(b){var a=this,f=a.getRuid(),d=a.elem.parent().get(0);if(d&&!c.contains(d,b.currentTarget))return!1;a._getTansferFiles(b,function(b){a.trigger("drop",c.map(b,function(a){return new g(f,a)}))});a.dndOver=!1;a.elem.removeClass("webuploader-dnd-over");return!1},_getTansferFiles:function(b,a){var c=[],k=[],e,g,h,l,m,v,
p;b=b.originalEvent||b;g=b.dataTransfer;e=g.items;g=g.files;p=!(!e||!e[0].webkitGetAsEntry);m=0;for(v=g.length;m<v;m++)h=g[m],l=e&&e[m],p&&l.webkitGetAsEntry().isDirectory?k.push(this._traverseDirectoryTree(l.webkitGetAsEntry(),c)):c.push(h);d.when.apply(d,k).done(function(){c.length&&a(c)})},_traverseDirectoryTree:function(b,a){var c=d.Deferred(),k=this;b.isFile?b.file(function(b){a.push(b);c.resolve()}):b.isDirectory&&b.createReader().readEntries(function(b){var g=b.length,h=[],l=[],m;for(m=0;m<
g;m++)h.push(k._traverseDirectoryTree(b[m],l));d.when.apply(d,h).then(function(){a.push.apply(a,l);c.resolve()},c.reject)});return c.promise()},destroy:function(){var b=this.elem;b.off("dragenter",this.dragEnterHandler);b.off("dragover",this.dragEnterHandler);b.off("dragleave",this.dragLeaveHandler);b.off("drop",this.dropHandler);this.options.disableGlobalDnd&&(c(document).off("dragover",this.dragOverHandler),c(document).off("drop",this.dropHandler))}})});l("runtime/html5/filepaste",["base","runtime/html5/runtime",
"lib/file"],function(d,h,g){return h.register("FilePaste",{init:function(){var c=this.options,b=this.elem=c.container,a=".*",f,k,e,g;if(c.accept){f=[];k=0;for(e=c.accept.length;k<e;k++)(g=c.accept[k].mimeTypes)&&f.push(g);f.length&&(a=f.join(","),a=a.replace(/,/g,"|").replace(/\*/g,".*"))}this.accept=new RegExp(a,"i");this.hander=d.bindFn(this._pasteHander,this);b.on("paste",this.hander)},_pasteHander:function(c){var b=[],a=this.getRuid(),f,d,e,h,l;c=c.originalEvent||c;f=c.clipboardData.items;h=0;
for(l=f.length;h<l;h++)d=f[h],"file"===d.kind&&(e=d.getAsFile())&&b.push(new g(a,e));b.length&&(c.preventDefault(),c.stopPropagation(),this.trigger("paste",b))},destroy:function(){this.elem.off("paste",this.hander)}})});l("runtime/html5/filepicker",["base","runtime/html5/runtime"],function(d,h){var g=d.$;return h.register("FilePicker",{init:function(){var c=this.getRuntime().getContainer(),b=this,a=b.owner,f=b.options,d=g(document.createElement("label")),e=g(document.createElement("input")),h,l,m,
q;e.attr("type","file");e.attr("name",f.name);e.addClass("webuploader-element-invisible");d.on("click",function(){e.trigger("click")});d.css({opacity:0,width:"100%",height:"100%",display:"block",cursor:"pointer",background:"#ffffff"});f.multiple&&e.attr("multiple","multiple");if(f.accept&&0<f.accept.length){h=[];l=0;for(m=f.accept.length;l<m;l++)h.push(f.accept[l].mimeTypes);e.attr("accept",h.join(","))}c.append(e);c.append(d);q=function(b){a.trigger(b.type)};e.on("change",function(c){var f=arguments.callee,
d;b.files=c.target.files;d=this.cloneNode(!0);this.parentNode.replaceChild(d,this);e.off();e=g(d).on("change",f).on("mouseenter mouseleave",q);a.trigger("change")});d.on("mouseenter mouseleave",q)},getFiles:function(){return this.files},destroy:function(){}})});l("runtime/html5/util",["base"],function(d){var h=m.createObjectURL&&m||m.URL&&URL.revokeObjectURL&&URL||m.webkitURL,g=d=d.noop;h&&(d=function(){return h.createObjectURL.apply(h,arguments)},g=function(){return h.revokeObjectURL.apply(h,arguments)});
return{createObjectURL:d,revokeObjectURL:g,dataURL2Blob:function(c){var b,a,f,d;d=c.split(",");b=~d[0].indexOf("base64")?atob(d[1]):decodeURIComponent(d[1]);c=new ArrayBuffer(b.length);a=new Uint8Array(c);for(f=0;f<b.length;f++)a[f]=b.charCodeAt(f);b=d[0].split(":")[1].split(";")[0];return this.arrayBufferToBlob(c,b)},dataURL2ArrayBuffer:function(c){var b,a;c=c.split(",");c=~c[0].indexOf("base64")?atob(c[1]):decodeURIComponent(c[1]);b=new Uint8Array(c.length);for(a=0;a<c.length;a++)b[a]=c.charCodeAt(a);
return b.buffer},arrayBufferToBlob:function(c,b){var a=m.BlobBuilder||m.WebKitBlobBuilder;return a?(a=new a,a.append(c),a.getBlob(b)):new Blob([c],b?{type:b}:{})},canvasToDataUrl:function(c,b,a){return c.toDataURL(b,a/100)},parseMeta:function(c,b){b(!1,{})},updateImageHead:function(c){return c}}});l("runtime/html5/imagemeta",["runtime/html5/util"],function(d){var h;h={parsers:{65505:[]},maxMetaDataSize:262144,parse:function(d,c){var b=this,a=new FileReader;a.onload=function(){c(!1,b._parse(this.result));
a=a.onload=a.onerror=null};a.onerror=function(b){c(b.message);a=a.onload=a.onerror=null};d=d.slice(0,b.maxMetaDataSize);a.readAsArrayBuffer(d.getSource())},_parse:function(d,c){if(!(6>d.byteLength)){var b=new DataView(d),a=2,f=b.byteLength-4,k=a,e={},l,m;if(65496===b.getUint16(0)){for(;a<f;)if(l=b.getUint16(a),65504<=l&&65519>=l||65534===l){m=b.getUint16(a+2)+2;if(a+m>b.byteLength)break;k=h.parsers[l];if(!c&&k)for(l=0;l<k.length;l+=1)k[l].call(h,b,a,m,e);k=a+=m}else break;6<k&&(e.imageHead=d.slice?
d.slice(2,k):(new Uint8Array(d)).subarray(2,k))}return e}},updateImageHead:function(d,c){var b=this._parse(d,!0),a;a=2;b.imageHead&&(a=2+b.imageHead.byteLength);a=d.slice?d.slice(a):(new Uint8Array(d)).subarray(a);b=new Uint8Array(c.byteLength+2+a.byteLength);b[0]=255;b[1]=216;b.set(new Uint8Array(c),2);b.set(new Uint8Array(a),c.byteLength+2);return b.buffer}};d.parseMeta=function(){return h.parse.apply(h,arguments)};d.updateImageHead=function(){return h.updateImageHead.apply(h,arguments)};return h});
l("runtime/html5/imagemeta/exif",["base","runtime/html5/imagemeta"],function(d,h){var g={ExifMap:function(){return this}};g.ExifMap.prototype.map={Orientation:274};g.ExifMap.prototype.get=function(c){return this[c]||this[this.map[c]]};g.exifTagTypes={1:{getValue:function(c,b){return c.getUint8(b)},size:1},2:{getValue:function(c,b){return String.fromCharCode(c.getUint8(b))},size:1,ascii:!0},3:{getValue:function(c,b,a){return c.getUint16(b,a)},size:2},4:{getValue:function(c,b,a){return c.getUint32(b,
a)},size:4},5:{getValue:function(c,b,a){return c.getUint32(b,a)/c.getUint32(b+4,a)},size:8},9:{getValue:function(c,b,a){return c.getInt32(b,a)},size:4},10:{getValue:function(c,b,a){return c.getInt32(b,a)/c.getInt32(b+4,a)},size:8}};g.exifTagTypes[7]=g.exifTagTypes[1];g.getExifValue=function(c,b,a,f,k,e){f=g.exifTagTypes[f];var h,l;if(f)if(h=f.size*k,l=4<h?b+c.getUint32(a+8,e):a+8,l+h>c.byteLength)d.log("Invalid Exif data: Invalid data offset.");else{if(1===k)return f.getValue(c,l,e);b=[];for(a=0;a<
k;a+=1)b[a]=f.getValue(c,l+a*f.size,e);if(f.ascii){c="";for(a=0;a<b.length;a+=1){k=b[a];if("\x00"===k)break;c+=k}return c}return b}else d.log("Invalid Exif data: Invalid tag type.")};g.parseExifTag=function(c,b,a,d,k){var e=c.getUint16(a,d);k.exif[e]=g.getExifValue(c,b,a,c.getUint16(a+2,d),c.getUint32(a+4,d),d)};g.parseExifTags=function(c,b,a,f,k){var e,g,h;if(a+6>c.byteLength)d.log("Invalid Exif data: Invalid directory offset.");else if(e=c.getUint16(a,f),g=a+2+12*e,g+4>c.byteLength)d.log("Invalid Exif data: Invalid directory size.");
else{for(h=0;h<e;h+=1)this.parseExifTag(c,b,a+2+12*h,f,k);return c.getUint32(g,f)}};g.parseExifData=function(c,b,a,f){a=b+10;var k;if(1165519206===c.getUint32(b+4))if(a+8>c.byteLength)d.log("Invalid Exif data: Invalid segment size.");else if(0!==c.getUint16(b+8))d.log("Invalid Exif data: Missing byte alignment offset.");else{switch(c.getUint16(a)){case 18761:b=!0;break;case 19789:b=!1;break;default:d.log("Invalid Exif data: Invalid byte alignment marker.");return}42!==c.getUint16(a+2,b)?d.log("Invalid Exif data: Missing TIFF marker."):
(k=c.getUint32(a+4,b),f.exif=new g.ExifMap,g.parseExifTags(c,a,a+k,b,f))}};h.parsers[65505].push(g.parseExifData);return g});l("runtime/html5/image",["base","runtime/html5/runtime","runtime/html5/util"],function(d,h,g){return h.register("Image",{modified:!1,init:function(){var c=this,b=new Image;b.onload=function(){c._info={type:c.type,width:this.width,height:this.height};c._metas||"image/jpeg"!==c.type?c.owner.trigger("load"):g.parseMeta(c._blob,function(a,b){c._metas=b;c.owner.trigger("load")})};
b.onerror=function(){c.owner.trigger("error")};c._img=b},loadFromBlob:function(c){var b=this._img;this._blob=c;this.type=c.type;b.src=g.createObjectURL(c.getSource());this.owner.once("load",function(){g.revokeObjectURL(b.src)})},resize:function(c,b){var a=this._canvas||(this._canvas=document.createElement("canvas"));this._resize(this._img,a,c,b);this._blob=null;this.modified=!0;this.owner.trigger("complete")},getAsBlob:function(c){var b=this._blob,a=this.options;c=c||this.type;if(this.modified||this.type!==
c){b=this._canvas;if("image/jpeg"===c){if(b=g.canvasToDataUrl(b,"image/jpeg",a.quality),a.preserveHeaders&&this._metas&&this._metas.imageHead)return b=g.dataURL2ArrayBuffer(b),b=g.updateImageHead(b,this._metas.imageHead),b=g.arrayBufferToBlob(b,c)}else b=g.canvasToDataUrl(b,c);b=g.dataURL2Blob(b)}return b},getAsDataUrl:function(c){var b=this.options;c=c||this.type;return"image/jpeg"===c?g.canvasToDataUrl(this._canvas,c,b.quality):this._canvas.toDataURL(c)},getOrientation:function(){return this._metas&&
this._metas.exif&&this._metas.exif.get("Orientation")||1},info:function(c){return c?(this._info=c,this):this._info},meta:function(c){return c?(this._meta=c,this):this._meta},destroy:function(){var c=this._canvas;this._img.onload=null;c&&(c.getContext("2d").clearRect(0,0,c.width,c.height),c.width=c.height=0,this._canvas=null);this._img.src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D";this._img=this._blob=null},_resize:function(c,b,a,d){var k=this.options,e=c.width,g=c.height,h=this.getOrientation(),
l;~[5,6,7,8].indexOf(h)&&(a^=d,d^=a,a^=d);l=Math[k.crop?"max":"min"](a/e,d/g);k.allowMagnify||(l=Math.min(1,l));e*=l;g*=l;k.crop?(b.width=a,b.height=d):(b.width=e,b.height=g);a=(b.width-e)/2;d=(b.height-g)/2;k.preserveHeaders||this._rotate2Orientaion(b,h);this._renderImageToCanvas(b,c,a,d,e,g)},_rotate2Orientaion:function(c,b){var a=c.width,d=c.height,k=c.getContext("2d");switch(b){case 5:case 6:case 7:case 8:c.width=d,c.height=a}switch(b){case 2:k.translate(a,0);k.scale(-1,1);break;case 3:k.translate(a,
d);k.rotate(Math.PI);break;case 4:k.translate(0,d);k.scale(1,-1);break;case 5:k.rotate(.5*Math.PI);k.scale(1,-1);break;case 6:k.rotate(.5*Math.PI);k.translate(0,-d);break;case 7:k.rotate(.5*Math.PI);k.translate(a,-d);k.scale(-1,1);break;case 8:k.rotate(-.5*Math.PI),k.translate(-a,0)}},_renderImageToCanvas:function(){function c(b,a,c){var d=document.createElement("canvas"),e=d.getContext("2d");a=0;var g=c,h=c;d.width=1;d.height=c;e.drawImage(b,0,0);for(b=e.getImageData(0,0,1,c).data;h>a;)d=b[4*(h-
1)+3],0===d?g=h:a=h,h=g+a>>1;c=h/c;return 0===c?1:c}return d.os.ios?7<=d.os.ios?function(b,a,d,g,e,h){var l=a.naturalWidth,m=a.naturalHeight,q=c(a,l,m);return b.getContext("2d").drawImage(a,0,0,l*q,m*q,d,g,e,h)}:function(b,a,d,g,e,h){var l=a.naturalWidth,m=a.naturalHeight;b=b.getContext("2d");var q;var v=a.naturalWidth,p;1048576<v*a.naturalHeight?(p=document.createElement("canvas"),p.width=p.height=1,p=p.getContext("2d"),p.drawImage(a,-v+1,0),q=0===p.getImageData(0,0,1,1).data[3]):q=!1;var r="image/jpeg"===
this.type;p=v=0;var w,u;q&&(l/=2,m/=2);b.save();q=document.createElement("canvas");q.width=q.height=1024;w=q.getContext("2d");r=r?c(a,l,m):1;e=Math.ceil(1024*e/l);for(h=Math.ceil(1024*h/m/r);v<m;){for(u=r=0;r<l;)w.clearRect(0,0,1024,1024),w.drawImage(a,-r,-v),b.drawImage(q,0,0,1024,1024,d+u,g+p,e,h),r+=1024,u+=e;v+=1024;p+=h}b.restore()}:function(b,a,c,d,e,g){b.getContext("2d").drawImage(a,c,d,e,g)}}()})});l("runtime/html5/transport",["base","runtime/html5/runtime"],function(d,h){var g=d.noop,c=d.$;
return h.register("Transport",{init:function(){this._status=0;this._response=null},send:function(){var b=this.owner,a=this.options,f=this._initAjax(),g=b._blob,e=a.server,h,l,m;a.sendAsBinary?(e+=(/\?/.test(e)?"&":"?")+c.param(b._formData),l=g.getSource()):(h=new FormData,c.each(b._formData,function(a,b){h.append(a,b)}),h.append(a.fileVal,g.getSource(),a.filename||b._formData.name||""));a.withCredentials&&"withCredentials"in f?(f.open(a.method,e,!0),f.withCredentials=!0):f.open(a.method,e);this._setRequestHeader(f,
a.headers);l?(f.overrideMimeType("application/octet-stream"),d.os.android?(m=new FileReader,m.onload=function(){f.send(this.result);m=m.onload=null},m.readAsArrayBuffer(l)):f.send(l)):f.send(h)},getResponse:function(){return this._response},getResponseAsJson:function(){return this._parseJson(this._response)},getStatus:function(){return this._status},abort:function(){var b=this._xhr;b&&(b.upload.onprogress=g,b.onreadystatechange=g,b.abort(),this._xhr=null)},destroy:function(){this.abort()},_initAjax:function(){var b=
this,a=new XMLHttpRequest;!this.options.withCredentials||"withCredentials"in a||"undefined"===typeof XDomainRequest||(a=new XDomainRequest);a.upload.onprogress=function(a){var c=0;a.lengthComputable&&(c=a.loaded/a.total);return b.trigger("progress",c)};a.onreadystatechange=function(){if(4===a.readyState)return a.upload.onprogress=g,a.onreadystatechange=g,b._xhr=null,b._status=a.status,200<=a.status&&300>a.status?(b._response=a.responseText,b.trigger("load")):500<=a.status&&600>a.status?(b._response=
a.responseText,b.trigger("error","server")):b.trigger("error",b._status?"http":"abort")};return b._xhr=a},_setRequestHeader:function(b,a){c.each(a,function(a,c){b.setRequestHeader(a,c)})},_parseJson:function(b){var a;try{a=JSON.parse(b)}catch(c){a={}}return a}})});l("preset/html5only","base widgets/filednd widgets/filepaste widgets/filepicker widgets/image widgets/queue widgets/runtime widgets/upload widgets/validator runtime/html5/blob runtime/html5/dnd runtime/html5/filepaste runtime/html5/filepicker runtime/html5/imagemeta/exif runtime/html5/image runtime/html5/transport".split(" "),
function(d){return d});l("webuploader",["preset/html5only"],function(d){return d});return x("webuploader")});